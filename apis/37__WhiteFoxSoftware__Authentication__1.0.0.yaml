penapi: 3.0.0
info:
  version: '1.0.0'
  title: 'White Fox Security API'
  description: 'Api para login e Permissões'
# Added by API Auto Mocking Plugin
servers:
# Added by API Auto Mocking Plugin
  - description: White Fox Api
    url: http://whitefoxsecurityservice.azurewebsites.net
paths:
  /token:
    post:
      summary: valida determinado usuario e senha para uma aplicação
      operationId: login
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginParameters'
      responses:
        '200':
          description: detalhes do usuario e permissões na aplicação
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoginOutcome'
  /refreshToken:
    post:
      summary: gera um novo access token a partir do refresh token
      operationId: refreshToken
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RefreshTokenParameters'
      responses:
        '401':
          description: unauthorized
        '200':
          description: token de acesso
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TokenResult'
  /changePassword:
    post:
      summary: troca a senha de um usuario logado
      operationId: changePassowrd
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ChangePasswordParameters'
      responses:
        '401':
          description: unauthorized
        '200':
          description: token de acesso
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ChangePasswordOutcome'
  /generatePasswordKey:
    post:
      summary: gera key para definição de senha de um usuario
      operationId: generatePasswordKey
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GeneratePasswordKeyParameters'
      responses:
        '401':
          description: unauthorized
        '200':
          description: token de acesso
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GeneratePasswordKeyOutcome'
  /validatePasswordKey:
    post:
      summary: valida uma key para definição de senha de um usuario
      operationId: validatePasswordKey
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ValidatePasswordKeyParameters'
      responses:
        '401':
          description: unauthorized
        '200':
          description: token de acesso
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidatePasswordKeyResult'
components:
  schemas:
    ValidatePasswordKeyParameters:
      type: object
      required:
       - Key
      properties:
        Key:
          type: string
          nullable: false
    ValidatePasswordKeyResult:
      type: object
      required:
       - Valid
      properties:
        UserName:
          type: string
          nullable: true
        Valid:
          type: boolean
          nullable: false
    GeneratePasswordKeyParameters:
      type: object
      required:
       - UserName
       - Email
      properties:
        UserName:
          type: string
          nullable: false
        Email:
          type: string
          nullable: false
    ChangePasswordParameters:
      type: object
      required:
       - ApplicatioId
      properties:
        ApplicationId:
          type: string
          format: uuid
          nullable: false
        UserName:
          type: string
          nullable: true
        Password:
          type: string
          nullable: true
        ChangePasswordKey:
          type: string
          nullable: true
    GeneratePasswordKeyOutcome:
      type: object
      required:
       - Key
      properties:
        Key:
          type: string
          nullable: false
    ChangePasswordOutcome:
      type: object
      required:
       - Result
      properties:
        Result:
          type: string
          nullable: false
          description:
            0-based
          enum: 
            - Succces 
            - FailedInvalidUserPassword
            - FailedDisabledUser
            - FailedLockedUser
            - InvalidPasswordLength
            - InvalidPasswordComplexity
            - PasswordRecentlyUsed
            - InvalidChangePasswordKey
    RefreshTokenParameters:
      type: object
      required:
       - ApplicatioId
       - ClientId
       - Token
      properties:
        ApplicationId:
          type: string
          format: uuid
          nullable: false
        ClientId:
          type: string
          format: uuid
          nullable: true
        Token:
          type: string
          nullable: false
    LoginParameters:
      type: object
      required:
       - ApplicatioId
       - UserName
       - Password
      properties:
        ApplicationId:
          type: string
          format: uuid
          nullable: false
        UserName:
          type: string
          nullable: false
        Password:
          type: string
          nullable: false
        ClientId:
          type: string
          format: uuid
          nullable: true
    TokenResult:
      type: object
      properties:
        Token: 
          type: string
          nullable: true
        RefreshToken:
          type: string
          nullable: true
        UserName:
          type: string
          nullable: true
        Permissions:
          type: array
          items:
            type: integer
        ExpiresIn:
          type: integer
          format: int32
          nullable: true
          description: expiration time in seconds
    LoginOutcome:
      allOf: 
        - $ref: '#/components/schemas/TokenResult'
        - type: object
          required:
            - Result
          properties:
             Result:
                type: string
                nullable: false
                description:
                  0-based
                enum: 
                  - Succces 
                  - SuccessShouldChangePassword
                  - FailedExpiredPassword
                  - FailedInvalidUserPassword
                  - FailedForbiddenApplication
                  - FailedDisabledUser
                  - FailedLockedUser
                  - FailedInvalidToken
                  - FailedExpiredToken
                  - FailedUsedToken