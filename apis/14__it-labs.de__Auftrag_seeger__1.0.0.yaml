penapi: 3.0.0
info:
  version: "1.0.0"
  title: 'Aufträge - Kumavision (Seeger)'
  description: 'Synchronisation der Bestellungen aus Alberta mit den Aufträgen in Kumavision'
paths:
  /order:
    get:
      tags:
        - order
      parameters:
        - name: api_key
          in: header
          required: true
          schema:
            type: string
        - in: query
          name: status
          required: true
          schema:
            type: string
          description: created (später ggf. archived) - 
        - in: query
          name: updatedAfter
          required: true
          schema:
            type: string
          description: '2018-02-21T09:30:00.000Z (im UTC-Format)'    
      summary: Bestellungen je nach Status abrufen
      description: Szenario - Kumavision fragt in einem bestimmten Intervall bei Alberta nach, ob es neu angelegte Bestellungen gibt
        ----- Aufruf => order/?status=[status]&updatedAfter=[updatedAfter]
      operationId: getCreatedOrders
      responses:
        '200':
          description: Neu angelegte Bestellungen vorhanden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ArrayOfOrders'
            application/xml:
              schema:
                $ref: '#/components/schemas/ArrayOfOrders'
        '400':
          description: Bad Request -> Syntaxfehler im Request
        '401':
          description: Unauthorized -> keine Berechtigung für Operation
    post:
      tags:
        - order
      parameters:
        - name: api_key
          in: header
          required: true
          schema:
            type: string
      summary: Auftrag hinzufügen
      description: Szenario - ein Auftrag wurde Kumavision angelegt und soll in Alberta übertragen werden
      operationId: addOrder
      responses:
        '201':
          description: Created - Auftrag wurde angelegt. Ein Mapping von  BestellungsId aus Alberta mit der AuftragsId aus Kumavision. Zusätzlich für jede Bestellzeile die Id aus Alberta und die der Auftragszeile aus Kumavision.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrderMapping'
            application/xml:
              schema:
                 $ref: '#/components/schemas/OrderMapping'
                 
        '401':
          description: Unauthorized -> keine Berechtigung für Operation
        '400':
          description: Bad Request -> Syntaxfehler im Request
        '405':
          description: Validierung fehlgeschlagen -> fehlende Pflichtfelder
      requestBody:
        $ref: '#/components/requestBodies/Order'
    patch:
      tags:
        - orderStatus
      parameters:
        - name: api_key
          in: header
          required: true
          schema:
            type: string
        - name: id
          in: query
          required: true
          schema:
            type: string
          description: die Id des zu ändernden Autrags 
      summary: Auftragsstatus (ggf. auch Rezeptstatus) ändern
      description: Szenario - ein Auftrag wurde in Kumavision geändert und diese Änderungen sollen in Alberta übertragen werden ----- Aufruf => orderStatus/[orderId]
      operationId: updateOrderStatus
      responses:
        '200':
          description: OK - Auftrag wurde geändert.
        '401':
          description: Unauthorized -> keine Berechtigung für Operation
        '400':
          description: Bad Request -> Syntaxfehler im Request
        '405':
          description: Validierung fehlgeschlagen -> Status konnte nicht gesetzt werden
      requestBody:
        $ref: '#/components/requestBodies/OrderStatus'
  /erpOrder:
    post:
      tags:
        - erpOrder
      parameters:
        - name: api_key
          in: header
          required: true
          schema:
            type: string
      summary: Auftrag aus dem WaWi hinzufügen
      description: Szenario - ein Auftrag wurde im WaWi angelegt und soll in Alberta übertragen werden
      operationId: addErpOrder
      responses:
        '201':
          description: Created - Auftrag wurde angelegt.
        '401':
          description: Unauthorized -> keine Berechtigung für Operation
        '400':
          description: Bad Request -> Syntaxfehler im Request
        '405':
          description: Validierung fehlgeschlagen -> fehlende Pflichtfelder
      requestBody:
        $ref: '#/components/requestBodies/erpOrder'
    put:
        parameters:
        - name: api_key
          in: header
          required: true
          schema:
            type: string
        - name: id
          in: query
          required: true
          schema:
            type: string
          description: die Id des zu ändernden Autrag aus Kumavision, z. B. A323232
        summary: Auftrag aus Kumavision ändern => komplett überschreiben
        description: Szenario - ein Auftrag wurde in Kumavision geändert und soll in Alberta überschrieben werden
        operationId: putErpOrder
        responses:
          '200':
          description: OK - Auftrag wurde geändert.
          '401':
            description: Unauthorized -> keine Berechtigung für Operation
          '400':
            description: Bad Request -> Syntaxfehler im Request
          '405':
            description: Validierung fehlgeschlagen -> fehlende Pflichtfelder
        requestBody:
          $ref: '#/components/requestBodies/erpOrder'
  /order/orderMapping:
    get:
      tags:
        - orderMapping
      parameters:
        - name: api_key
          in: header
          required: true
          schema:
            type: string
        - in: query
          name: customerId
          required: true
          schema:
            type: string
          description: die Id des Kunden aus Kumavision
      summary: Zuordnung Auftrag (Kumavision) zu Bestellung (Alberta) abrufen
      description: Szenario - Kumavision fragt bei Alberta nach, welche Alberta-Id dem jeweiligen Auftrag zugeordnet ist
      operationId: getOrderMapping
      responses:
        '200':
          description: Mapping vorhanden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrderMapping'
            application/xml:
              schema:
                $ref: '#/components/schemas/OrderMapping'
        '400':
          description: Bad Request -> Syntaxfehler im Request
        '401':
          description: Unauthorized -> keine Berechtigung für Operation
components:
  schemas:
    Order:
      type: object
      required:
        - patientId
        - deliveryDate
        - deliveryAddress
        - doctorId
        - therapyId
      properties:
        _id:
          type: string
          example: a4adecb6-126a-4fa6-8fac-e80165ac8980 -> muss bei POST leer bleiben
        salesId:
          type: string
          example: A323232
          description: Id des Auftrag in Kumavision
        patientId:
          type: string
          example: a4adecb6-126a-4fa6-8fac-e80165ac4264
        creationDate:
          type: string
          format: date
          example: "2018-08-07T06:53:00Z"
        deliveryDate:
          type: string
          format: date
          example: "2018-08-20"
        startDate:
          type: string
          format: dateupdate
          description: Versorgungsbeginn
          example: "2018-08-15"
        endDate:
          type: string
          format: date
          description: Versorgungsende
          example: "2018-09-15"
        deliveryInterval:
          type: object
          properties:
            amount: 
              type: number
              example: 3
              description: Anzahl der Tage, Wochen, Monate 
            timePeriod: 
              type: string
              example: "M"
              description: Zeiteinheit T=Tage, W=Wochen, M=Monate, J=Jahre 
        deliveryAddress:
          type: object
          required:
            - name
            - address
            - additionalAddress
            - postalCode
            - city
          properties:
            KUMAANREDECODE:
              type: string
              example: H
            name: 
              type: string
              example: Max Mustermann
            address:
              type: string
              example: Martin-Richter-Str. 22
            additionalAddress: 
              type: string
              example:  Hinterhaus
            additionalAddress2: 
              type: string
              example:  3. OG
            postalCode:
              type: string
              example: 90489
            city:
              type: string
              example: Nürnberg
        doctorId:
          type: string
          example: 5ab23c369d69c74b68cff5f7
          description: Voraussetzung, Alberta-Id ist bereits durch initialen Abgleich in Kumavision vorhanden
        pharmacyId:
          type: string
          example: 5ab2379c9d69c74b68cee819
          description: Id der Apotheke bei PE/IV-Therapien (Voraussetzung, Alberta-Id ist bereits durch initialen Abgleich in Kumavision vorhanden)
        therapyId:
          type: number
          example: 1
          description: Id der Therapie (0= Unbekannt, 1 = Parenterale Ernährung, 2 = Enterale Ernährung, 3 = Stoma, 4 = Tracheostoma, 5 = Inkontinenz, 6 = Wundversorgung, 7 = IV-Therapien, 8 = Beatmung, 9 = Diabetes, 10 = Sonstiges)
        therapyTypeId:
          type: number
          example: 4
          description: Id der Therapieart (Schwerkraft_PE = 0, Pumpe_immobil_PE = 1, Pumpe_mobil_PE = 2, Schwerkraft_EE = 3, Pumpe_immobil_EE = 4, Pumpe_mobil_EE = 5, Bolus = 6, Trinknahrung = 7, Kolostoma = 8, Urostoma = 9, Ileostoma = 10, Tracheostoma_beatmet = 11, Laryngektomie_beatmet = 12, Inkontinenz_ableitend = 13, Ulcus_cruris = 14, Dekubitus = 15, Diabetisches_Fußsyndrom = 16, Ulzerierte_Tumore = 17, Wundfisteln = 18, sonstige_chronische_Wunden = 19, Diabetes = 20, Pflegehilfsmittel = 21, Inkontinenz_aufsaugend = 22, Compounding = 23, Fistel = 24, Antibiose = 25, Tracheostoma_unbeatmet = 26, Laryngektomie_unbeatmet = 27, Absaugung_außerhalb_von_TS = 28, Beatmung = 29, sonstige_Wunden = 30)
        isInitialCare:
          type: boolean
          example: true
        isAdditionalDelivery:
          type: boolean
          example: false
        orderedArticleLines:
          type: array
          items: 
            $ref: '#/components/schemas/OrderedArticleLine'
          description: Die einzelnen Bestellzeilen mit Artikeln
        createdBy:
          type: string
          example: 5a6ca8b6456c14307cb9ae35
          description: Id des Erstellers (Voraussetzung, Alberta-Id ist bereits durch initialen Abgleich der Benutzer in Kumavision vorhanden)
        status:
          type: number
          example: 1
          description: 0 = Unbekannt, 1 = Gespeichert, 2 = Angelegt, 3 = Auftrag erstellt, 4 = Versandt, 5 = Teillieferung ...
        isSeriesOrder:
          type: boolean
          example: false
          description: Serienbestellung ja-nein
        seriesOrderChanged:
          type: boolean
          example: false
          description: Serienbestellung geändert
        annotation:
          type: string
          example: Das ist ein Hinweis an den Innendienst
          description: Hinweise zur Bestellung
        archived:
          type: boolean
          example: false
          description: Kennzeichen ob Bestellung archiviert ist oder nicht
        updatedAt:
          type: string
          format: date
          example: "2019-02-06T15:42:00Z"
          description: Der Zeitstempel der letzten Änderung
      xml:
        name: Bestellung
    ErpOrder:
      type: object
      required:
        - patientId
        - salesId
        - outboundDate
        - deliveryAddress
        - erpOrderedArticleLines
      properties:
        _id:
          type: string
          example: a4adecb6-126a-4fa6-8fac-e80165ac8980 -> muss bei POST leer bleiben
        salesId:
          type: string
          example: A323232
          description: Id des Auftrags im WaWi
        patientId:
          type: string
          example: a4adecb6-126a-4fa6-8fac-e80165ac4264
        outboundDate:
          type: string
          format: date
          example: "2018-08-20"
        deliveryAddress:
          type: object
          required:
            - name
            - address
            - postalCode
            - city
          properties:
            name: 
              type: string
              example: Max Mustermann
            address:
              type: string
              example: Martin-Richter-Str. 22
            additionalAddress: 
              type: string
              example:  Hinterhaus 3. OG
            additionalAddress2: 
              type: string
              example:  c/o Müller
            postalCode:
              type: string
              example: 90489
            city:
              type: string
              example: Nürnberg
        therapyId:
          type: number
          example: 1
          description: Id der Therapie (0= Unbekannt, 1 = Parenterale Ernährung, 2 = Enterale Ernährung, 3 = Stoma, 4 = Tracheostoma, 5 = Inkontinenz ableitend, 6 = Wundversorgung, 7 = IV-Therapien, 8 = Beatmung, 9 = Diabetes, 10 = Pflegehilfsmittel) 
        erpOrderedArticleLines:
          type: array
          items: 
            $ref: '#/components/schemas/ErpOrderedArticleLine'
          description: Die einzelnen Bestellzeilen aus dem WaWi mit Artikeln
        annotation:
          type: string
          example: Das ist ein Hinweis an den Außendienst
          description: Hinweise zur Bestellung
        archived:
          type: boolean
          example: false
          description: Kennzeichen ob Bestellung archiviert ist oder nicht
        updated:
          type: string
          format: date
          example: "12.10.2017 15:00:33"
          description: Der Zeitstempel der letzten Änderung
      xml:
        name: Bestellung
    OrderedArticleLine:
      type: object
      properties:
        _id:
          type: string
          example: 5a6ca8b6456c14307cb9ae35 -> muss bei POST leer bleiben
          description: Id der bestellten Artikelzeile
        salesLineId:
          type: string
          example: AL1
          description: Id der einzelnen Verkaufszeile im WaWi
        articleId:
          type: string
          example: 43452
          description: Id des Artikels im Wawi
        quantity:
          type: number
          example: 3
          description: Anzahl
        unit:
          type: string
          example: STK, PCK20, PCK50
          description: STK = Stück, PCK[Anzahl] = Karton/Verpackung mit Anzahl Stück
        durationForSeriesOrder:
          type: object
          properties:
            amount: 
              type: number
              description: die Anzahl der Tage, Wochen, Monate
            timeperiod:
              type: number
              example: 5 = Wochen
              description: gibt die Zeiteinheit an
                Unknown = 0,
                Minute = 1,
                Hour = 2,
                Day = 3,
                Week = 4,
                Month = 5,
                Quarter = 6,
                HalfYear = 7,
                Year = 8
        isRentalEquipment:
          type: boolean
          example: false
          description: Mietgerät/Fremdgerät
        isPrivateSale:
          type: boolean
          example: true
          description: Privatkauf Ja/Nein
        notAutomaticDelivery:
          type: boolean
          example: false
          description: Keine automatische Belieferung ja - nein
        updated:
          type: string
          format: date
          example: "12.10.2017 15:00:33"
          description: Der Zeitstempel der letzten Änderung
    ErpOrderedArticleLine:
      type: object
      properties:
        _id:
          type: string
          example: 5a6ca8b6456c14307cb9ae35 -> muss bei POST leer bleiben
          description: Id der bestellten Artikelzeile
        articleId:
          type: string
          example: 43452
          description: Id des Artikels im WaWi
        quantity:
          type: number
          example: 3
          description: Anzahl
        unit:
          type: string
          example: STK
          description: Stk = Stück, Ktn = Karton/Verpackung
        deliveredQuantity:
          type: number
          example: 2
          description: gelieferte Menge
        updated:
          type: string
          format: date
          example: "12.10.2017 15:00:33"
          description: Der Zeitstempel der letzten Änderung
    ArrayOfOrders:
      type: array
      items:
        $ref: '#/components/schemas/Order'
      example: [ {_id: a4adecb6-126a-4fa6-8fac-e80165ac8980,
                  salesId: A323232,
                  patientId: a4adecb6-126a-4fa6-8fac-e80165ac4264,
                  creationDate: 07.08.2018,
                  deliveryDate: 20.08.2018,
                  startDate: 15.08.2018,
                  endDate: 15.09.2018,
                  deliveryInterval: {
                    amount: 3,
                    timePeriod: M },
                  deliveryAddress: {
                    name: Max Mustermann,
                    address: Martin-Richter-Str. 22,
                    additionalAddress: Hinterhaus 3. OG,
                    postalCode: 90489,
                    city: Nürnberg },
                  doctorId: 5ab23c369d69c74b68cff5f7,
                  pharmacyId: "",
                  therapyId: 1,
                  isInitialCare: true, 
                  orderedArticleLines: [{
                        _id: 5a6ca8b6456c14307cb9ae35,
                        salesLineId: AL1,
                        articleId: 43452,
                        quantity: 3,
                        unit: STK,
                        isRentalEquipment: false,
                        updated: "12.10.2017 15:00:33" }],
                  createdBy: 5a6ca8b6456c14307cb9ae35,
                  status: 1,
                  isSeriesOrder: true,
                  seriesOrderChanged: true,
                  annotation: Das ist ein Hinweis an den Innendienst,
                  archived: false,
                  updated: "12.10.2017 15:00:33"
                  } ]
      description: Eine Auflistung von Bestellungen
    OrderStatus:
        type: object
        required:
          - orderId
          - salesId
          - status
        properties:
          orderId:
            type: string
            example: a4adecb6-126a-4fa6-8fac-e80165ac4264
            description: Alberta-Id der Bestellung
          salesId:
            type: string
            example: A123445
            description: Id des Auftrags aus WaWi
          status:
            type: number
            example: 3
            description: 0 = Unbekannt, 1 = Gespeichert, 2 = Angelegt, 3 = Auftrag erstellt, 4 = Versandt, 5 = Teillieferung ...
          updated:
            type: string
            format: date
            example: "12.10.2017 15:00:33"
            description: Der Zeitstempel der letzten Änderung
    OrderMapping:
        type: object
        required:
          - type
          - orderId
          - _id
        properties:
          orderId:
            type: string
            example: a4adecb6-126a-4fa6-8fac-e80165ac4264
            description: Alberta-Id der Bestellung
          salesId:
            type: string
            example: A123445 
            description: Id des Auftrags aus WaWi
          orderedArticleLineMapping:
            type: array
            items: 
              $ref: '#/definitions/orderedArticleLineMapping'
          updated:
            type: string
            format: date
            example: "12.10.2017 15:00:33"
            description: Der Zeitstempel der letzten Änderung
        xml:
          name: OrderMapping
  requestBodies:
    Order:
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Order'
        application/xml:
          schema:
            $ref: '#/components/schemas/Order'
      description: Die Bestellung
      required: true
    OrderStatus:
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/OrderStatus'
        application/xml:
          schema:
            $ref: '#/components/schemas/OrderStatus'
      description: Der Bestellstatus
      required: true
    OrderMapping:
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/OrderMapping'
        application/xml:
          schema:
            $ref: '#/components/schemas/OrderMapping'
      description: Das Mapping von Auftrag im WaWi zu Bestellung in Alberta
      required: true
definitions:
  orderedArticleLineMapping:
    type: object
    properties:
      name:
        orderedArticleLineId: string
        salesLineId: name of the object
        updated:
            type: string
            format: date
            description: Der Zeitstempel der letzten Änderung
    example: {orderedArticleLineId: 5a6ca8b6456c14307cb9ae35, salesLineId: A2, updated: "12.10.2017 15:00:33"}
# Added by API Auto Mocking Plugin
servers:
  - description: SwaggerHub API Auto Mocking
    url: https://virtserver.swaggerhub.com/it-labs.de/Auftrag_seeger/1.0.0