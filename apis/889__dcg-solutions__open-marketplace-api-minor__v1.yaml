openapi: 3.0.0

info:
  version: "v1"
  title: Open Marketplace API
  description: |
    Version minor of OMA "Open Marketplace API", highlighting the __Freight Quote__ and __Order Notification__.
  
servers:
  - url: 'Orders: https://notify.hub.dcg.com.br/v1/'
    description: Orders endpoint
  - url: 'Freight: https://api.hub.dcg.com.br/'
    description: Freight endpoint

paths:
  
  /freight/{marketplace}:
    post:
      tags:
        - Freight
      parameters:
        - in: header
          name: x-api-token
          required: true
          schema:
            type: string
            description: Token de acesso usado para autenticação e identificação do seller.
        - in: path
          name: marketplace
          required: true
          schema:
            type: string
            description: Identificador do marketplace que está realizando a chamada.
      summary: Retorna cotação para um carrinho
      description: >
        Esta API deve ser implementada pelo integrador e o marketplace irá
        realizar cotações baseadas nestes contratos de requisição e resposta.


        1. Caso por qualquer motivo um ou mais SKUs não possam ser entregues,
        no retorno a coleção de shipmentOptions e pickupOptions estarão vazios.


        2. Em caso de HTTP Status diferente de 200 na resposta ao Consultar o
        Frete, o marketplace deverá ativar o modo de contingência.


        3. Em caso do conteúdo da resposta inválida, o marketplace deverá ativar o modo de contingência.
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/FreightQuoteRequest'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FreightQuoteResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        5XX:
          $ref: '#/components/responses/UnexpectedError'
          
  /{marketplace}/orders:
    post:
      tags:
        - Orders
      parameters:
        - in: header
          name: x-api-token
          required: true
          schema:
            type: string
            description: Token de acesso usado para autenticação e identificação do seller.
        - in: path
          name: marketplace
          required: true
          schema:
            type: string
            description: Identificador do marketplace que está realizando a chamada.
      summary: Notifica um novo pedido
      description: >
        Esta API deve ser implementada pelo integrador e o marketplace irá
        realizar notificações sempre que um novo pedido for realizado ou então atualizado.
        
        
        __IMPORTANTE__: Em caso de HTTP Status diferente de 2xx na resposta ao notificar o
        pedido, o marketplace deverá entender que a notificação não aconteceu com sucesso e controlar a retentativa.
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/OrderRequest'
      responses:
        '201':
          $ref: '#/components/responses/Created'
        '400':
          $ref: '#/components/responses/BadRequest'
        5XX:
          $ref: '#/components/responses/UnexpectedError'
  /{marketplace}/orders/{orderId}/statuses/{status}:
    put:
      tags:
        - Orders
      parameters:
        - in: path
          name: orderId
          required: true
          schema:
            type: string
        - in: path
          name: marketplace
          required: true
          schema:
            type: string
            description: Identificador do marketplace que está realizando a chamada.
        - in: path
          name: status
          required: true
          schema:
            type: string
            description: Status do pedido
            enum:
              - approved
              - canceled
        - in: header
          name: x-api-token
          required: true
          schema:
            type: string
            description: Token de acesso usado para autenticação e identificação do seller.
      summary: Altera o status de um pedido
      responses:
        '204':
          $ref: '#/components/responses/NoContent'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        5XX:
          $ref: '#/components/responses/UnexpectedError'
  /{marketplace}/stores/{storeId}:
    get:
      tags:
        - Stores
      parameters:
        - in: path
          name: storeId
          required: true
          schema:
            type: string
        - in: path
          name: marketplace
          required: true
          schema:
            type: string
            description: Identificador do marketplace que está realizando a chamada.
        - in: header
          name: x-api-token
          required: true
          schema:
            type: string
            description: Token de acesso usado para autenticação e identificação do seller.
      summary: Retorna detalhes de uma loja
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Store'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        5XX:
          $ref: '#/components/responses/UnexpectedError'
                
components:

  responses:
    Created:
      description: Created
    NoContent:
      description: No content (success)
    NotFound:
      description: The specified resource was not found
    Unauthorized:
      description: Unauthorized
    BadRequest:
      description: Bad request.
    UnexpectedError:
      description: Unexpected error.

  schemas:
    Address:
      type: object
      description: Representação dos dados de um endereço
      properties:
        country:
          type: string
          description: País.
          example: BR
        city:
          type: string
          description: Cidade.
          example: 'São Paulo'
        zipCode:
          type: string
          description: Código postal.
          example: '90000000'
        reference:
          type: string
          description: Referência.
          example: 'Próximo a Linx'
        number:
          type: string
          description: Número.
          example: 22
        complement:
          type: string
          description: Complemento.
          example: Apartamento 202
        fullName:
          type: string
          description: Nome completo do Pagador (Em caso de endereço de cobrança) ou Destinatário (Em caso de endereço de entrega).
          example: 'João Pedro da Silva'
        phone:
          type: array
          description: Telefones
          items:
            $ref: '#/components/schemas/Phone'
        street:
          type: string
          description: Nome da rua
          example: Alameda Campinas
        neighborhood:
          type: string
          description: Bairro
          example: Jardins
        state:
          type: string
          description: Estado
          example: SP
    Customer:
      type: object
      description: Representação dos dados de um cliente
      properties:
        type: 
          type: string
          description: Tipo de cliente
          example: Person
          enum:
          - Person
          - Company
        name:
          type: string
          description: Nome
          example: João
        surname:
          type: string
          description: Sobrenome
          example: Silva
        email:
          type: string
          description: E-mail
          example: customer@domain.com
        gender:
          type: string
          description: Gênero
          example: Male
          enum:
          - Male
          - Female
        documentNumber:
          type: string
          description: CPF (Person) ou CNPJ (Customer)
          example: 2046709851
        phone:
          type: array
          description: Telefones
          items:
            $ref: '#/components/schemas/Phone'
        tradingName:
          type: string
          description: Razão Social, em caso de cliente do tupo Company.
          example: Company SA
        birthDate: 
          type: string
          description: Data de aniversário.
          example: '2020-02-19T17:52:36.008Z'
        stateInscription: 
          type: string
          description: Inscrição estadual, em caso de cliente do tipo Company.
          example: "120102120"
    Phone:
      type: object
      description: Representação dos dados de um telefone
      properties:
        number:
          description: Número do telefone
          example: '11945678900'
          type: string
        type:
          description: Tipo do telefone
          enum:
            - Cellphone
            - Landline
          type: string
    OrderRequest:
      type: object
      description: Representação dos dados de um pedido
      properties:
        code:
          type: string
          description: Código identificador do pedido no marketplace.
          example: '10203040'
        channel:
          type: string
          description: >-
            Canal de venda onde o pedido foi realizado. Ex: Submarino, Americanas, Shoptime.
          example: Submarino
        status:
          type: string
          description: Status do pedido no marketplace.
          enum:
            - new
            - processing
            - shipped
            - delivered
            - canceled
        purchaseDate:
          type: string
          description: Data em que a compra foi realizada.
          example: '2018-11-19T14:42:33.000Z'
        approvedDate:
          type: string
          description: Data de aprovação de pagamento do pedido.
          example: '2018-11-20T10:11:33.000Z'
        updatedDate:
          type: string
          description: Data da última atualização do pedido.
          example: '2018-11-20T10:11:33.000Z'
        customer:
          $ref: '#/components/schemas/Customer'
        billingAddress:
          $ref: '#/components/schemas/Address'
        deliveryType:
          description: >-
            Identifica como a entrega foi cotada (SellerAPI | Fallback |
            Gateway)
          enum:
            - SellerAPI (API do integrador)
            - Fallback (Contingência do marketplace)
            - Gateway (Gateway externo)
          example: SellerAPI
          type: string
        fulfillments:
          type: array
          items:
            $ref: '#/components/schemas/Fulfillment'
        payments:
          type: array
          items:
            $ref: '#/components/schemas/Payment'
    Fulfillment:
      type: object
      description: Representação dos dados de uma entrega
      properties:
        id:
          description: Identificador do fulfillment
          type: integer
          example: 1
        methodId:
          description: Identificador da modalidade de entrega
          example: Express
          enum:
            - Standard
            - Express
            - Scheduled
            - Pickup
          type: string
        status:
          description: Status do fulfillment.
          example: pending
          enum:
            - pending
            - invoiced
            - shipped
            - delivered
            - canceled
            - pickup-ready
            - pickup-fail
          type: string
        delivery:
          $ref: '#/components/schemas/Delivery'
        items:
          description: Representação dos itens deste fulfillment
          type: array
          items:
            $ref: '#/components/schemas/Item'
    Item:
      type: object
      description: Representação dos dados de Item de uma entrega
      properties:
        sku:
          type: string
          description: Código identificador do sku.
          example: '1234567'
        name:
          type: string
          description: Nome da variação (sku).
          example: 'Produto na cor branca'
        quantity:
          type: integer
          description: Quantidade de itens deste sku
          example: 2
        price:
          type: number
          description: Preço de venda do item.
          example: 19.90
        discount:
          type: number
          description: Valor de desconto do item, se houver.
          example: 0.00
        width:
          type: integer
          description: Largura do item. Caso não se aplique, enviar zero.
          example: 0.0
        height:
          type: integer
          description: Altura do item. Caso não se aplique, enviar zero.
          example: 0.0
        length:
          type: integer
          description: Profundidade do item. Caso não se aplique, enviar zero.
          example: 0.0
        weight:
          type: integer
          description: Peso do item. Caso não se aplique, enviar zero.
          example: 0.0
    Delivery:
      type: object
      description: Representação dos dados de uma entrega
      properties:
        optionId:
          description: Identificador do serviço de entrega.
          example: '1010'
          type: string
        additionalInfo:
          description: Campo livre com detalhes da entrega.
          example: '1'
          type: string
        price:
          type: number
          description: Preço cobrado pela entrega. Caso se aplique.
          example: 10.90
        unityTime:
          type: string
          description: Define se os valores dos outros atributos relacionados à prazo de entrega é em Minutos, Horas ou Dias.
          example: hours
          enum:
            - minutes
            - hours
            - days
        time:
          type: integer
          description: Tempo estimado de entrega ou disponibilidade para retirada, na unidade de tempo definida em unityTime. Considerando que o prazo é definido com base nos dias úteis.
          example: 24
        handlingTime:
          type: integer
          description: Tempo de manuseio, na unidade de tempo definida em unityTime. Considerando que o prazo é definido com base nos dias úteis. Caso não se aplique, enviar zero.
          example: 0
        pickup:
          type: object
          description: Representação de dados relacionados à retirada na loja. Caso se aplique.
          properties:
            deadline:
              type: integer
              description: Prazo limite para o pickup ser realizado, na unidade de tempo definida em unityTime. Caso a entrega seja do tipo retirada em loja.
              example: 0
        scheduled:
          type: object
          description: Representação dos dados de uma entrega agendada. Caso se aplique.
          properties:
            scheduledAt: 
              type: string
              description: Data agendada para entrega
              example: "2020-01-28"
            scheduledPeriod: 
              type: string
              description: Turno agendado para entrega
              example: MORNING
              enum:
                - MORNING
                - AFTERNOON
                - EVENING
        address:
          $ref: '#/components/schemas/Address'
    Shipment:
      type: object
      description: Representação dos dados de uma entrega
      properties:
        serviceId:
          description: Identificador do serviço de entrega.
          example: 'Sedex'
          type: string
        carrierId:
          description: Identificador da transportadora.
          example: '1'
          type: string
        carrierName:
          description: Nome da transportadora.
          example: Correios
          type: string
        status:
          description: Status do fulfillment.
          example: pending
          enum:
            - Pending
            - Invoiced
            - Shipped
            - Delivered
            - Canceled
          type: string
        shipmentPrice:
          type: number
          description: Preço cobrado de frete.
          example: 10.90
        unityTime:
          type: string
          description: Define se os valores dos outros atributos relacionados à prazo de entrega é em Minutos, Horas ou Dias.
          example: hours
          enum:
            - minutes
            - hours
            - days
        shipmentTime:
          type: integer
          description: Tempo de entrega, na unidade de tempo definida em unityTime. Considerando que o prazo é definido com base nos dias úteis.
          example: 24
        handlingTime:
          type: integer
          description: Tempo de manuseio, na unidade de tempo definida em unityTime. Considerando que o prazo é definido com base nos dias úteis. Caso não se aplique, enviar zero.
          example: 0
        address:
          $ref: '#/components/schemas/Address'
    Pickup:
      type: object
      description: Representação dos dados de uma retirada
      properties:
        pickupOptionId:
          description: Identificador do ponto de retirada.
          example: '1010'
          type: string
        status:
          description: Status do fulfillment.
          example: pending
          enum:
            - Pending
            - Pickup-Ready
            - Pickup-Fail
            - Pickup-Done
            - Canceled
          type: string
        pickupPrice:
          type: number
          description: Preço cobrado pela retirada. Caso se aplique.
          example: 0.00
        unityTime:
          type: string
          description: Define se os valores dos outros atributos relacionados à prazo de entrega é em Minutos, Horas ou Dias.
          example: hours
          enum:
            - minutes
            - hours
            - days
        pickupTime:
          type: integer
          description: Prazo para retirada estar disponível, na unidade de tempo definida em unityTime. Considerando que o prazo é definido com base nos dias úteis.
          example: 24
        pickupDeadline:
          type: integer
          description: Prazo limite para o pickup ser realizado, na unidade de tempo definida em unityTime.
          example: 0
        address:
          $ref: '#/components/schemas/Address'
    Payment:
      type: object
      description: Representação dos dados de um pagamento
      properties:
        type:
          description: Tipo de pagamento
          type: string
          example: CREDIT_CARD
          enum:
            - CREDIT_CARD
            - BILL
        brand:
          type: string
          description: Bandeira do cartão
          example: "VISA"
        discount:
          type: number
          description: Desconto
          example: 1.00
        interest:
          type: number
          description: Juros
          example: 3.00
        transactionDate:
          type: string
          description: Data da transação
          example: '2018-11-19T14:42:33.000Z'
        transactionId:
          type: string
          description: Identificador da transação
          example: 10
        value:
          type: number
          description: Valor do pagamento
          example: 199.90
        installments:
          type: integer
          description: Número de parcelas
          example: 2
        nsu:
          type: string
          description: NSU
          example:
    Store:
      type: object
      description: Representação dos dados de uma loja
      properties:
        id:
          description: Identificador da loja
          example: '1'
          type: string
        name:
          description: Nome da loja
          example: Matriz
          type: string
        description:
          description: Descrição da loja
          example: Loja da Avenida Paulista
          type: string
        status:
          description: Status da loja
          enum:
            - active
            - inactive
          example: active
          type: string
        phone:
          $ref: '#/components/schemas/Phone'
        address:
          type: object
          description: Representação dos dados do endereço da loja
          properties:
            country:
              type: string
              description: País.
              example: BR
            city:
              type: string
              description: Cidade.
              example: 'São Paulo'
            zipCode:
              type: string
              description: Código postal.
              example: '90000000'
            reference:
              type: string
              description: Referência.
              example: 'Próximo a Linx'
            number:
              type: string
              description: Número.
              example: 22
            complement:
              type: string
              description: Complemento.
              example: Apartamento 202
            street:
              type: string
              description: Nome da rua
              example: Alameda Campinas
            neighborhood:
              type: string
              description: Bairro
              example: Jardins
            state:
              type: string
              description: Estado
              example: SP
            lat:
              type: number
              description: Latitude
              example: -32.562693359870195
            long:
              type: number
              description: Longitude
              example: -75.45601654999198
        availableDays:
          type: object
          description: Dias e horários disponíveis para retirada
          example:
            monday: 
              start: '09:00:00.000Z'
              end: "18:00:00.000Z"
            tuesday:
              start: '09:00:00.000Z'
              end: "18:00:00.000Z"
          additionalProperties:
            type: object
            description: > 
              Dias de funcionamento do local de retirada. Opção: monday, tuesday, wednesday, thursday, friday, saturday, sunday.
            properties:
              start:
                type: string
              end:
                type: string
  
    FreightQuoteRequest:
      type: object
      description: Representação dos dados de uma cotação de frete
      properties:
        definitions:
          description: Definições da cotação
          type: object
          properties:
            allowPickup:
              description: Permite opções de retirada na loja
              example: true
              type: boolean
            allowSchedule:
              description: Permite opções de entrega agendada
              example: true
              type: boolean
            unityTime:
              description: >-
                Define se os valores esperados nos atributos de prazo de entrega é em Minutos,
                Horas ou Dias.
              example: hours
              enum:
                - minutes
                - hours
                - days
              type: string
        destinationZipcode:
          description: Código postal do endereço de destino (somente números).
          example: 00000000
          type: string
        items:
          description: Lista de produtos
          type: array
          items:
            type: object
            properties:
              sku:
                description: Código que identifica o SKU (variação)
                example: '123456'
                type: string
              quantity:
                description: Quantidade de itens deste SKU
                example: 2
                type: integer
              price:
                description: Preço de venda do SKU
                example: 11.99
                type: number
              weight:
                description: Peso do SKU em Quilos. Caso não se aplique, enviar zero.
                example: 0.0
                type: number
              width:
                description: Largura em Centímetros. Caso não se aplique, enviar zero.
                example: 0.0
                type: number
              height:
                description: Altura em Centímetros. Caso não se aplique, enviar zero.
                example: 0.0
                type: number
              lenght:
                description: Profundidade em Centímetros. Caso não se aplique, enviar zero.
                example: 0.0
                type: number
    FreightQuoteResponse:
      type: object
      description: Representação do retorno de uma cotação de frete
      properties:
        shipmentOptions:
          description: Opções de entrega para uma cotação
          type: array
          items:
            type: object
            properties:
              items:
                description: >-
                  Items da entrega, se vazio considera-se que todos os items da
                  cotação serão entregues nesta opção de entrega.
                type: array
                items:
                  type: object
                  properties:
                    sku:
                      description: Identificador do SKU (variação)
                      example: '123456'
                      type: string
                    quantity:
                      description: >-
                        Quantidade de itens deste SKU que será entregue nesta
                        cotação.
                      example: 1
                      type: integer
              methodId:
                description: Identificador da modalidade de entrega
                example: Express
                enum:
                  - Standard
                  - Express
                  - Scheduled
                type: string
              optionId:
                description: Identificador da opção de entrega
                example: '1'
                type: string
              additionalInfo:
                description: 'Campo livre para identificar a entrega. Ex: Nome da transportadora.'
                example: 'Correios - Sedex'
                type: string
              price:
                description: Preço total do frete
                example: 19.9
                type: number
              shipmentTime:
                description: Representação dos dados de prazo da entrega
                type: object
                properties:
                  unityTime:
                    description: >-
                      Define se os valores dos outros atributos é em Minutos,
                      Horas ou Dias.
                    example: hours
                    enum:
                      - minutes
                      - hours
                      - days
                    type: string
                  shipmentTime:
                    description: >-
                      Tempo de entrega, na unidade de tempo definida em
                      unityTime. Considerando que o prazo é
                      definido com base nos dias úteis.
                    example: 168
                    type: integer
                  handlingTime:
                    description: >-
                      Tempo de manuseio do pedido, na unidade de tempo definida
                      em unityTime.
                    example: 24
                    type: integer
                  totalTime:
                    description: >-
                      Prazo de entrega final (soma dos valores de handlingTime e
                      shipmentTime), na unidade de tempo definida em unityTime.
                      Considerando que o prazo é definido com
                      base nos dias úteis.
                    example: 192
                    type: integer
              scheduledDateOptions:
                type: array
                description: Representação das opções para entrega agendada. Caso se aplique.
                items:
                  type: object
                  properties:
                    date:
                      type: string
                      description: Data
                      example: '2018-11-20'
                    options:
                      type: array
                      description: Opções de 'janelas' para a entrega.
                      items:
                        type: object
                        required:
                          - period
                        properties:
                          period:
                            type: string
                            description: Turno
                            example: AFTERNOON
                            enum:
                              - MORNING
                              - AFTERNOON
                              - EVENING
                          time:
                            type: array
                            description: Possibilidade disponibilizar intervalos específicos. (Opcional)
                            items:
                              type: object
                              properties:
                                start:
                                  type: string
                                  description: Horário de início.
                                  example: '14:00'
                                end:
                                  type: string
                                  description: Horário de fim.
                                  example: '16:00'
        pickupOptions:
          description: Opções de retirada para uma cotação. Caso não possua nenhuma opção de retirada, o  o objeto será retornado vazio.
          type: array
          items:
            type: object
            properties:
              items:
                description: >-
                  Items da retirada, se vazio considera-se que todos os items da
                  cotação serão contemplados nesta opção de retirada.
                type: array
                items:
                  type: object
                  properties:
                    sku:
                      description: Identificador do SKU (variação)
                      example: '123456'
                      type: string
                    quantity:
                      description: >-
                        Quantidade de itens deste SKU que será retirado nesta
                        opção.
                      example: 1
                      type: integer
              methodId:
                description: Identificador da modalidade de entrega
                example: Pickup
                enum:
                  - Pickup
                type: string
              optionId:
                description: Identificador do ponto de retirada. Com esse identificador é possível verificar detalhes do ponto de retirada em outra rota.
                type: string
                example: "1001"
              price:
                description: Valor a ser cobrado pela retirada. Caso se aplique.
                example: 0.00
                type: number
              pickupTime:
                description: Representação dos dados de prazo da retirada
                type: object
                properties:
                  unityTime:
                    description: >-
                      Define se os valores dos outros atributos é em Minutos,
                      Horas ou Dias.
                    example: hours
                    enum:
                      - minutes
                      - hours
                      - days
                    type: string
                  time:
                    description: >-
                      Prazo em que o pickup estará disponível, na unidade de tempo definida em
                      unityTime. Considerando que o prazo é
                      definido com base nos dias úteis.
                    example: 168
                    type: integer
                  deadline:
                    description: >-
                      Prazo limite em que o pickup estará disponível, na unidade de tempo definida em unityTime.
                      Considerando que o prazo é definido com
                      base nos dias úteis.
                    example: 192
                    type: integer
              #pickupInfos:
              #  description: Representação dos dados para retirada
              #  properties:
              #    address:
              #      type: object
              #      description: Representação dos dados do endereço para retirada
              #      properties:
              #        country:
              #          type: string
              #          description: País.
              #          example: BR
              #        city:
              #          type: string
              #          description: Cidade.
              #          example: 'São Paulo'
              #        zipCode:
              #          type: string
              #          description: Código postal.
              #          example: '90000000'
              #        reference:
              #          type: string
              #          description: Referência.
              #          example: 'Próximo a Linx'
              #        number:
              #          type: string
              #          description: Número.
              #          example: 22
              #        complement:
              #          type: string
              #          description: Complemento.
              #          example: Apartamento 202
              #        phone:
              #          $ref: '#/components/schemas/Phone'
              #        street:
              #          type: string
              #          description: Nome da rua
              #          example: Alameda Campinas
              #        neighborhood:
              #          type: string
              #          description: Bairro
              #          example: Jardins
              #        state:
              #          type: string
              #          description: Estado
              #          example: SP
              #        lat:
              #          type: number
              #          description: Latitude
              #          example: -32.562693359870195
              #        long:
              #          type: number
              #          description: Longitude
              #          example: -75.45601654999198
              #    name:
              #      type: string
              #      description: Nome do local para retirada
              #      example: Loja do Shopping Eldorada
              #    availableDays:
              #      type: object
              #      description: Dias e horários disponíveis para retirada
              #      example:
              #        monday: 
              #          start: '09:00:00.000Z'
              #          end: "18:00:00.000Z"
              #        tuesday:
              #          start: '09:00:00.000Z'
              #          end: "18:00:00.000Z"
              #      additionalProperties:
              #        type: object
              #        description: > 
              #          Dias de funcionamento do local de retirada. Opção: monday, tuesday, wednesday, thursday, friday, saturday, sunday.
              #        properties:
              #          start:
              #            type: string
              #          end:
              #            type: string