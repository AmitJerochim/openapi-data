{"openapi":"3.0.0","info":{"version":"1.1.0","title":"Teletype Public API","description":"## Общая информация\nВы можете использовать данную документацию для ознакомления с методами API. Описание произведено в формате [**Swagger 3.0**](https://github.com/OAI/OpenAPI-Specification/blob/master/versions/3.0.0.md). Для генерации базового кода для работы с API на удобном для вас языке программирования воспользуйтесь утилитой [**Swagger Codegen**](https://swagger.io/swagger-codegen/) или online сервисом [**Swagger Editor**](https://editor.swagger.io/).\n\nПо всем вопросам работы с API обращайтесь к нам по email: <a href=\"mailto:p@teletype.app\">p@teletype.app</a></li>"},"paths":{"/messages":{"get":{"tags":["Messages"],"summary":"Получение списка сообщений","description":"Возвращает список сообщений отсортированый в порядке убывания даты отправки сообщения с группировкой по диалогам","parameters":[{"$ref":"#/components/parameters/AuthTokenHeader"},{"$ref":"#/components/parameters/AuthTokenParam"},{"$ref":"#/components/parameters/PageNumber"},{"$ref":"#/components/parameters/PageSize"},{"name":"dialogId","in":"query","description":"Идентификатор диалога","schema":{"type":"string"}},{"name":"channelId","in":"query","description":"Идентификатор канала","schema":{"type":"string"}},{"name":"clientId","in":"query","description":"Идентификатор клиента","schema":{"type":"string"}}],"responses":{"200":{"description":"Список сообщений","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean"},"data":{"type":"object","properties":{"currentPage":{"$ref":"#/components/schemas/currentPage"},"totalItems":{"$ref":"#/components/schemas/totalItems"},"totalPages":{"$ref":"#/components/schemas/totalPages"},"pageSize":{"$ref":"#/components/schemas/pageSize"},"items":{"type":"array","items":{"$ref":"#/components/schemas/message"}}}},"errors":{"type":"array","items":{"$ref":"#/components/schemas/Error"}}}}}}}}}},"/message/send":{"post":{"tags":["Messages"],"summary":"Отправка сообщения","description":"Позволяет отправить сообщение с опциональным вложением медиафайла в диалог с клиентом по ID диалога","parameters":[{"$ref":"#/components/parameters/AuthTokenHeader"},{"$ref":"#/components/parameters/AuthTokenParam"}],"requestBody":{"required":true,"content":{"multipart/form-data":{"schema":{"properties":{"dialogId":{"type":"string","description":"Идентификатор диалога"},"text":{"type":"string","description":"Текст сообщения"},"file":{"type":"string","format":"binary","description":"Файл аттачмента"},"url":{"type":"string","description":"Ссылка на файл аттачмента. Используется если не передан file"}},"required":["dialogId","text"]}}}},"responses":{"200":{"description":"Список идентификаторов созданных сообщений","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean"},"data":{"type":"object","properties":{"ids":{"type":"array","items":{"type":"string","description":"Идентификатор сообщения"}}}},"errors":{"type":"array","items":{"$ref":"#/components/schemas/Error"}}}}}}}}}},"/clients":{"get":{"tags":["Clients"],"summary":"Получение списка клиентов","description":"Возврашает список клиентов, с которыми присутствуют диалоги в данном проекте","parameters":[{"$ref":"#/components/parameters/AuthTokenHeader"},{"$ref":"#/components/parameters/AuthTokenParam"},{"$ref":"#/components/parameters/PageNumber"},{"$ref":"#/components/parameters/PageSize"},{"name":"clientId","in":"query","description":"Идентификатор клиента","schema":{"type":"string"}},{"name":"clientPhone","in":"query","description":"Номер телефона клиента","example":"+79161234567","schema":{"type":"string"}}],"responses":{"200":{"description":"Список клиентов","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean"},"data":{"type":"object","properties":{"currentPage":{"$ref":"#/components/schemas/currentPage"},"totalItems":{"$ref":"#/components/schemas/totalItems"},"totalPages":{"$ref":"#/components/schemas/totalPages"},"pageSize":{"$ref":"#/components/schemas/pageSize"},"items":{"type":"array","items":{"type":"object","properties":{"id":{"type":"string","description":"Идентификатор клиента"},"isOnline":{"type":"boolean","description":"Признак того, что клиент сейчас онлан"},"lastOnlineAt":{"type":"string","description":"Время последнего присутствия онлайн","example":"2019-05-30T18:03:57+00:00"},"phoneIsLocked":{"type":"boolean","description":"Признак блокировки телефона"},"emailIsLocked":{"type":"boolean","description":"Признак  блокировки Email"},"banned":{"type":"boolean","description":"Признак того, что клиент заблокирован"},"averageRate":{"type":"number","description":"Средний рейтинг клиента"},"firstMessageAt":{"type":"string","description":"Время первого сообщения клиента","example":"2019-05-30T18:03:57+00:00"},"lastMessageAt":{"type":"string","description":"Время последнего сообщения клиента","example":"2019-05-30T18:03:57+00:00"},"name":{"type":"string","description":"Имя клиента"},"avatar":{"type":"string","description":"Ссылка на превью аватара клиента"},"avatarOriginal":{"type":"string","description":"Ссылка на оригинальный размер аватара клиента"},"color":{"type":"string","description":"Цвет"},"animal":{"type":"string","description":"Животное"},"phone":{"type":"string","description":"Телефон"},"email":{"type":"string","description":"Email"}}}}}},"errors":{"type":"array","items":{"$ref":"#/components/schemas/Error"}}}}}}}}}},"/client/dialog":{"get":{"tags":["Clients"],"summary":"Получение последнего диалога клиента","description":"Возвращает диалог с клиентом полученный по дате последнего сообщения по убыванию","parameters":[{"$ref":"#/components/parameters/AuthTokenHeader"},{"$ref":"#/components/parameters/AuthTokenParam"},{"name":"clientId","in":"query","description":"Идентификатор клиента","schema":{"type":"string"},"required":true},{"name":"channelId","in":"query","description":"Идентификатор канала","schema":{"type":"string"}},{"name":"channelType","in":"query","description":"Тип канала","schema":{"type":"string","example":"whatsapp"}}],"responses":{"200":{"description":"Диалог клиента","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean"},"data":{"type":"object","properties":{"id":{"type":"string","description":"Идентификатор диалога"},"url":{"type":"string","description":"Ссылка на активный диалог в панели телетайп"}}},"errors":{"type":"array","items":{"$ref":"#/components/schemas/Error"}}}}}}}}}},"/client/details/{clientId}":{"get":{"tags":["Clients"],"summary":"Получение подробных данных клиента","description":"Возвращает подробную информацию о клиенте","parameters":[{"$ref":"#/components/parameters/AuthTokenHeader"},{"$ref":"#/components/parameters/AuthTokenParam"},{"name":"clientId","in":"path","description":"Идентификатор клиента","schema":{"type":"string"},"required":true}],"responses":{"200":{"description":"Данные клиента","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean"},"data":{"type":"object","properties":{"id":{"type":"string","description":"Идентификатор клиента"},"isOnline":{"type":"boolean","description":"Признак того, что клиент сейчас онлан"},"lastOnlineAt":{"type":"string","description":"Время последнего присутствия онлайн","example":"2019-05-30T18:03:57+00:00"},"phoneIsLocked":{"type":"boolean","description":"Признак блокировки телефона"},"emailIsLocked":{"type":"boolean","description":"Признак  блокировки Email"},"banned":{"type":"boolean","description":"Признак того, что клиент заблокирован"},"averageRate":{"type":"number","description":"Средний рейтинг клиента"},"firstMessageAt":{"type":"string","description":"Время первого сообщения клиента","example":"2019-05-30T18:03:57+00:00"},"lastMessageAt":{"type":"string","description":"Время последнего сообщения клиента","example":"2019-05-30T18:03:57+00:00"},"name":{"type":"string","description":"Имя клиента"},"avatar":{"type":"string","description":"Ссылка на превью аватара клиента"},"avatarOriginal":{"type":"string","description":"Ссылка на оригинальный размер аватара клиента"},"color":{"type":"string","description":"Цвет"},"animal":{"type":"string","description":"Животное"},"phone":{"type":"string","description":"Телефон"},"email":{"type":"string","description":"Email"},"vk":{"type":"object","description":"Данные Вконтакте","properties":{"id":{"type":"string","description":"Идентификатор профиля Вконтакте"},"url":{"type":"string","description":"Ссылка на профиль Вконтакте"}}},"info":{"type":"object","description":"Дополнительная информация","properties":{"utmSource":{"type":"string","description":"UTM-метка источник"},"utmMedium":{"type":"string","description":"UTM-метка среда"},"utmCampaign":{"type":"string","description":"UTM-метка компания"},"utmTerm":{"type":"string","description":"UTM-метка условие"},"utmContent":{"type":"string","description":"UTM-метка контент"},"referrerUrl":{"type":"string","description":"Страница источник перехода"},"roistatVisit":{"type":"string","description":"Идентификатор визита Roistat"},"additionalPayload":{"type":"string","description":"Дополнительные данные"}}},"crmLinks":{"type":"object","description":"CRM системы","properties":{"amo_crm":{"type":"string","description":"Ссылка на клиента в AmoCrm"},"bitrix_crm":{"type":"string","description":"Ссылка на клиента в Bitrix24"}}},"location":{"type":"string","description":"Геолокация"},"language":{"type":"string","description":"Языковые настройки"},"timezone":{"type":"string","description":"Временная зона"},"userAgent":{"type":"string","description":"Данные браузера"},"userAgentVersion":{"type":"string","description":"Версия браузера"},"devicePlatform":{"type":"string","description":"Данные операционной системы"},"devicePlatformVersion":{"type":"string","description":"Версия операционной системы"},"gender":{"type":"string","description":"Пол"},"device":{"type":"string","description":"Устройство"},"ip":{"type":"string","description":"IP адрес"},"notes":{"type":"object","description":"Заметки","properties":{"id":{"type":"string","description":"Идентификатор заметки"},"operator":{"type":"object","description":"Оператор","properties":{"id":{"type":"string","description":"Идентификатор оператора"},"name":{"type":"string","description":"Имя оператора"},"avatar":{"type":"string","description":"Ссылка на аватар оператора"}}},"text":{"type":"string","description":"Текст заметки"},"created_at":{"type":"string","description":"Время последнего присутствия онлайн","example":"2019-05-30T18:03:57+00:00"}}},"pagesHistory":{"type":"object","description":"История посещенных страниц","properties":{"url":{"type":"string","description":"Url адрес страницы"},"title":{"type":"string","description":"Заголовок страницы"},"channel_id":{"type":"string","description":"Идентификатор канала"},"date":{"type":"string","description":"Время посещения страницы","example":"2019-05-30T18:03:57+00:00"}}},"appealsHistory":{"type":"object","description":"История диалогов","properties":{"id":{"type":"string","description":"Идентификатор диалога"},"lastMessageAt":{"type":"string","description":"Время последнего сообщения","example":"2019-05-30T18:03:57+00:00"},"channelType":{"type":"string","description":"Тип канала"},"channelName":{"type":"string","description":"Название канала"}}}}},"errors":{"type":"array","items":{"$ref":"#/components/schemas/Error"}}}}}}}}}},"/channels":{"get":{"tags":["Channels"],"summary":"Получение списка каналов","description":"Возвращает список активных каналов в текущем проекте","parameters":[{"$ref":"#/components/parameters/AuthTokenHeader"},{"$ref":"#/components/parameters/AuthTokenParam"},{"$ref":"#/components/parameters/PageNumber"},{"$ref":"#/components/parameters/PageSize"},{"name":"channelType","in":"query","description":"Тип канала","schema":{"type":"string","example":"whatsapp"}}],"responses":{"200":{"description":"Список каналов","content":{"application/json":{"schema":{"type":"object","properties":{"success":{"type":"boolean"},"data":{"type":"object","properties":{"currentPage":{"$ref":"#/components/schemas/currentPage"},"totalItems":{"$ref":"#/components/schemas/totalItems"},"totalPages":{"$ref":"#/components/schemas/totalPages"},"pageSize":{"$ref":"#/components/schemas/pageSize"},"items":{"type":"array","items":{"type":"object","properties":{"id":{"type":"string","description":"Идентификатор канала"},"name":{"type":"string","description":"Название канала"},"type":{"type":"string","description":"Тип канала","example":"whatsapp"},"state":{"type":"string","description":"Статус канала"},"dialogCount":{"type":"integer","description":"Количество открытых диалогов канала"}}}}}},"errors":{"type":"array","items":{"$ref":"#/components/schemas/Error"}}}}}}}}}},"/new-message":{"post":{"tags":["Webhooks"],"summary":"Событие поступления нового сообщения от клиента","description":"Событие отправляет на указанный в проекте Webhook данные о новом сообщении от клиента.\n\nПараметр `payload` содержит сериализованный массив с информацией о сообщении","requestBody":{"required":true,"content":{"multipart/form-data":{"schema":{"properties":{"name":{"type":"string","description":"new message"},"payload":{"description":"Сериализованный массив с данными события","$ref":"#/components/schemas/message"}},"required":["name","payload"]}}}},"responses":{"200":{"description":"Сервер должен вернуть 200 код без содержимого","content":{"text/plain":{"example":""}}}}}},"/success-send":{"post":{"tags":["Webhooks"],"summary":"Событие об успешной отправки сообщения","description":"Событие отправляет на указанный в проекте Webhook уведомление об успешной отправке оператором сообщения клиенту.\n\nПараметр `payload` содержит сериализованный массив с идентификаторами отправленного сообщения и диалога, в который оно отправлено","requestBody":{"required":true,"content":{"multipart/form-data":{"schema":{"properties":{"name":{"type":"string","description":"success send"},"payload":{"type":"object","description":"Сериализованный массив с данными события","properties":{"messageId":{"type":"string","description":"Идентификатор сообщения"},"dialogId":{"type":"string","description":"Идентификатор диалога"}}}},"required":["name","payload"]}}}},"responses":{"200":{"description":"Сервер должен вернуть 200 код без содержимого","content":{"text/plain":{"example":""}}}}}}},"servers":[{"url":"https://api.teletype.app/public/api/v1","description":"Рабочий сервер"}],"tags":[{"name":"Authentication","x-displayName":"Авторизация","description":"Для работы с API необходимо получить токен авторизации — отдельный для каждого проекта в панели Teletype.\n\n1. Подключаем Public API в настройках проекта в панели Teletype и получаем API Token для авторизации\n2. Выполняем запросы к API с заголовком `X-Auth-Token: <ACCESS_TOKEN>`<br><strong>или</strong> передаем его в качестве GET-параметра `?token=<ACCESS_TOKEN>`\n\nВремя действия токена неограничено. Сгенерировать новый токен вы в любой момент можете в настройках панели Teletype. При этом старый токен прекратит свое действие."},{"name":"Messages","x-displayName":"Сообщения","description":"Методы API для работы с сообщениями в диалогах"},{"name":"Clients","x-displayName":"Клиенты","description":"Методы API для работы с клиентами"},{"name":"Channels","x-displayName":"Каналы","description":"Методы API для работы с каналами"},{"name":"Webhooks","x-displayName":"Вебхуки","description":"В этом разделе описаны события, которые будут отправляться на ваш Вебхук URL. Указать данный урл Вы можете в настройках API вашего проекта в панели Teletype.\n\n<strong>Все события будут передаваться на один URL.</strong>"}],"components":{"parameters":{"AuthTokenParam":{"name":"token","in":"query","description":"Токен для авторизации","required":true,"schema":{"type":"string"}},"AuthTokenHeader":{"name":"X-Auth-Token","in":"header","description":"Токен для авторизации","required":true,"schema":{"type":"string"}},"PageNumber":{"name":"page","in":"query","description":"Текущая страница","schema":{"type":"integer"}},"PageSize":{"name":"pageSize","in":"query","description":"Количество данных на странице","schema":{"type":"integer"}}},"schemas":{"currentPage":{"type":"integer","description":"Текущая страница"},"totalItems":{"type":"integer","description":"Общее количество сообщений"},"totalPages":{"type":"integer","description":"Общее количество страниц"},"pageSize":{"type":"integer","description":"Количество сообщений на страницу"},"message":{"type":"object","properties":{"id":{"type":"string","description":"Идентификатор сообщения"},"dialogId":{"type":"string","description":"Идентификатор диалога"},"text":{"type":"string","description":"Текст сообщения"},"attachments":{"type":"array","description":"Аттачменты","items":{"type":"object","properties":{"id":{"type":"string","description":"Идентификатор аттачмента"},"url":{"type":"string","description":"Ссылка на аттачмент"},"type":{"type":"string","description":"Тип аттачмента"}}}},"operator":{"type":"object","description":"Массив данных оператора. NULL, если это сообщение пришло от клиента","properties":{"id":{"type":"string","description":"Идентификатор оператора"},"name":{"type":"string","description":"Имя оператора"},"avatar":{"type":"string","description":"Ссылка на аватар оператора"}}},"client":{"type":"object","description":"Массив данных клиента. NULL, если это сообщение пришло от оператора","properties":{"id":{"type":"string","description":"Идентификатор клиента"},"name":{"type":"string","description":"Имя клиента"},"avatar":{"type":"string","description":"Ссылка на аватар клиента"}}},"channel":{"type":"object","description":"Массив данных канала","properties":{"id":{"type":"string","description":"Идентификатор канала"},"type":{"type":"string","description":"Типа канала","example":"whatsapp"},"name":{"type":"string","description":"Название канала"}}},"createdAt":{"type":"object","properties":{"date":{"type":"string","description":"Дата и время создания сообщения","example":"2019-05-30T18:03:57+00:00"},"timezone":{"type":"string","description":"Временная зона","example":"UTC"}}},"isItClient":{"type":"boolean","description":"Признак того, что сообщение пришло от клиента"}}},"Error":{"type":"object","properties":{"code":{"type":"integer","example":400},"message":{"type":"string"}}}}}}