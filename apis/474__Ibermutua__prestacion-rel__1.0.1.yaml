penapi: 3.0.0
servers:
  - description: SwaggerHub API Auto Mocking
    url: https://virtserver.swaggerhub.com/Ibermutua/prestacion-rel/1.0.1
info:
  version: "1.0.1"
  title: Prestaciones REL
  description: >-
    This is an example of using OAuth2 Access Code Flow in a specification to
    describe security to your API.
security:
  - accessCode:
      - trabajador
      - emprleado
paths:
  '/v1/expedientes/rel/prestacion/{tipo}/{idExpediente}/iniciar':
    get:
      summary: Inicia la solicitud de una prestación
      description: Inicia la solicitud de una prestación
      parameters:
      - name: tipo
        in: path
        description: 20 para embarazo, 21 para lactancia
        required: true
        schema:
          type: integer
          format: int32
      - name: idExpediente
        in: path
        description: el identificador de la solicitud de empresa de la fase de certificación
        required: true
        schema:
          type: integer
          format: int64
      responses:
        '200':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PrestacionResponse'
          description: Devuelve la prestación, junto con los datos necesarios para cargar la pantalla
        '404':
          description: El idExpediente proporcionado no es correcto
        '400':
          description: Error de validación. Parámetros de entrada incorrectos
      security: []
      
  '/v1/expedientes/rel/prestacion/{tipo}/{idExpediente}/continuarBorrador':
    get:
      summary: Inicia la solicitud de una prestación
      description: Inicia la solicitud de una prestación
      parameters:
      - name: tipo
        in: path
        description: 20 para embarazo, 21 para lactancia
        required: true
        schema:
          type: integer
          format: int32
      - name: idExpediente
        in: path
        description: el identificador de la solicitud de empresa de la fase de certificación
        required: true
        schema:
          type: integer
          format: int64
      responses:
        '200':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PrestacionResponse'
          description: Devuelve la prestación, junto con los datos necesarios para cargar la pantalla
        '404':
          description: El idExpediente proporcionado no es correcto
        '400':
          description: Error de validación. Parámetros de entrada incorrectos
      security: []

  '/v1/expedientes/rel/prestacion/{tipo}/{idExpediente}':
    get:
      summary: Consultar una prestación
      description: Consultar una prestación
      parameters:
      - name: tipo
        in: path
        description: 20 para embarazo, 21 para lactancia
        required: true
        schema:
          type: integer
          format: int32
      - name: idExpediente
        in: path
        description: el identificador de la solicitud de empresa de la fase de certificación
        required: true
        schema:
          type: integer
          format: int64
      responses:
        '200':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PrestacionResponse'
          description: Devuelve la prestación, junto con los datos necesarios para cargar la pantalla
        '404':
          description: El idExpediente proporcionado no es correcto
        '400':
          description: Error de validación. Parámetros de entrada incorrectos
      security: []

  '/v1/expedientes/rel/prestacion/{tipo}/{idExpediente}/modelo145':
    post:
      summary: upload 145
      parameters:
      - name: tipo
        in: path
        description: 20 para embarazo, 21 para lactancia
        required: true
        schema:
          type: integer
          format: int32
      - name: idExpediente
        in: path
        description: el identificador de la solicitud de empresa de la fase de certificación
        required: true
        schema:
          type: integer
          format: int64
      requestBody:
        content: 
          multipart/form-data: 
            schema:            
              type: object
              properties:      
                file: 
                  type: string
                  format: binary          
      responses:
        '204':
          description: Fichero guardado correctamente
        '404':
          description: El idExpediente proporcionado no es correcto
        '400':
          description: Error de validación. Parámetros de entrada incorrectos
      security: []

  '/v1/expedientes/rel/prestacion/{tipo}/{idExpediente}/modelo280':
    post:
      summary: upload 280
      parameters:
      - name: tipo
        in: path
        description: 20 para embarazo, 21 para lactancia
        required: true
        schema:
          type: integer
          format: int32
      - name: idExpediente
        in: path
        description: el identificador de la solicitud de empresa de la fase de certificación
        required: true
        schema:
          type: integer
          format: int64
      requestBody:
        content: 
          multipart/form-data: 
            schema:            
              type: object
              properties:      
                file: 
                  type: string
                  format: binary          
      responses:
        '204':
          description: Fichero guardado correctamente
        '404':
          description: El idExpediente proporcionado no es correcto
        '400':
          description: Error de validación. Parámetros de entrada incorrectos
      security: []

  '/v1/expedientes/rel/prestacion/{tipo}/{idExpediente}/modelo144':
    post:
      summary: upload 144
      parameters:
      - name: tipo
        in: path
        description: 20 para embarazo, 21 para lactancia
        required: true
        schema:
          type: integer
          format: int32
      - name: idExpediente
        in: path
        description: el identificador de la solicitud de empresa de la fase de certificación
        required: true
        schema:
          type: integer
          format: int64
      requestBody:
        content: 
          multipart/form-data: 
            schema:            
              type: object
              properties:      
                file: 
                  type: string
                  format: binary          
      responses:
        '200':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Modelo144Response'
          description: Datos que han podido ser procesados vía OCR
        '404':
          description: El idExpediente proporcionado no es correcto
        '400':
          description: Error de validación. Parámetros de entrada incorrectos
      security: []


  '/v1/expedientes/rel/prestacion/{tipo}/{idExpediente}/certificadoSuspension':
    post:
      summary: upload certificado suspension
      parameters:
      - name: tipo
        in: path
        description: 20 para embarazo, 21 para lactancia
        required: true
        schema:
          type: integer
          format: int32
      - name: idExpediente
        in: path
        description: el identificador de la solicitud de empresa de la fase de certificación
        required: true
        schema:
          type: integer
          format: int64
      requestBody:
        content: 
          multipart/form-data: 
            schema:            
              type: object
              properties:      
                file: 
                  type: string
                  format: binary          
      responses:
        '200':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CertificadoSuspensionResponse'
          description: Datos que han podido ser procesados vía OCR
        '404':
          description: El idExpediente proporcionado no es correcto
        '400':
          description: Error de validación. Parámetros de entrada incorrectos
      security: []

  '/v1/expedientes/rel/prestacion/{tipo}/{idExpediente}/guardarBorrador':
    post:
      summary: Guarda los datos relativos a una prestación. No valida
      description: Guarda los datos relativos a una prestación. No valida
      parameters:
      - name: tipo
        in: path
        description: 20 para embarazo, 21 para lactancia
        required: true
        schema:
          type: integer
          format: int32
      - name: idExpediente
        in: path
        description: el identificador de la solicitud de empresa de la fase de certificación
        required: true
        schema:
          type: integer
          format: int64
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PrestacionRequest'
        description: Datos de la prestación
        required: true              
      responses:
        '204':
          description: Borrador guardado correctamente
        '404':
          description: El idExpediente proporcionado no es correcto
        '400':
          description: Error de validación. Parámetros de entrada incorrectos
      security: []

  '/v1/expedientes/rel/prestacion/{tipo}/{idExpediente}/tramitar':
    post:
      summary: Tramita una prestación
      description: Tramita una prestación
      parameters:
      - name: tipo
        in: path
        description: 20 para embarazo, 21 para lactancia
        required: true
        schema:
          type: integer
          format: int32
      - name: idExpediente
        in: path
        description: el identificador de la solicitud de empresa de la fase de certificación
        required: true
        schema:
          type: integer
          format: int64
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PrestacionRequest'
      responses:
        '200':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DatosPagoResponse'
          description: La prestación se ha guardado correctamente y se puede tramitar. Se necesita confirmar IRPF
        '204':
          description: La pretación se ha guardado correctamente, pero se queda en estado pendiente. No procede confirmación de datos.
        '404':
          description: El idExpediente proporcionado no es correcto
        '400':
          description: Error de validación. Parámetros de entrada incorrectos
      security: []

  '/v1/expedientes/rel/prestacion/{tipo}/{idExpediente}/confirmar':
    post:
      summary: Confirma el irpf de una prestación
      description: Confirma el irpf de una prestación
      parameters:
      - name: tipo
        in: path
        description: 20 para embarazo, 21 para lactancia
        required: true
        schema:
          type: integer
          format: int32
      - name: idExpediente
        in: path
        description: el identificador de la solicitud de empresa de la fase de certificación
        required: true
        schema:
          type: integer
          format: int64
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DatosPagoRequest'
      responses:
        '204':
          description: Tramitado correctamente
        '404':
          description: El idExpediente proporcionado no es correcto
        '400':
          description: Error de validación. Parámetros de entrada incorrectos
      security: []

components:
  schemas:
    Adjunto:
      type: object
      properties:
        nombre:
          type: string
          example: nombrefichero.pdf
        idAdjunto:
          type: integer
          format: int64
    Base:
      type: object
      properties:
        fecha:
          type: string
          example: '2020-10'
        dias:
          type: integer
          format: int32
          example: 30
        cProfesionales:
          type: number
          format: float
          example: 3000.20
        horasExtra:
          type: number
          format: float
          example: 100.10
    DatosPagoResponse:
      type: object
      properties:
        baseCotizacion:
          type: number
          format: float
          example: 1000.01
        cuotaObrera:
          type: number
          format: float
          example: 120.10
        baseReguladora:
          type: number
          format: float
          example: 900.10
        irpf:
          type: number
          format: float
          example: 19.21
    DatosPagoRequest:
      type: object
      properties:
        irpf:
          type: number
          format: float
          example: 19.21
    PrestacionRequest:
      type: object
      properties:
        tipo:
          type: integer
          format: int32
        idExpediente:
          type: integer
          format: int64
        iban:
          type: string
          example: ES0112341234123412341234
        viaCibermutua:
          type: boolean
          example: false
        tiempoCompleto:
          type: boolean
          example: false
        fechaSuspension:
          type: string
          example: '2020-10-10'
        bases:
          type: array
          items:
            $ref: '#/components/schemas/Base'
    PrestacionResponse:
      type: object
      properties:
        tipo:
          type: integer
          format: int32
        idExpediente:
          type: integer
          format: int64
        iniciada:
          type: boolean
          example: true
        iban:
          type: string
          example: ES0112341234123412341234
        foral:
          type: boolean
          example: false
        razonSocial:
          type: string
          example: "EMPRESA PRUEBA, S.A."
        autonomo:
          type: boolean
          example: false
        corrientePago:
          type: boolean
          example: true
        tieneCibermutua:
          type: boolean
          example: true
        viaCibermutua:
          type: boolean
          example: false
        tiempoCompleto:
          type: boolean
          example: false
        fechaSuspension:
          type: string
          example: '2020-10-10'
        bases:
          type: array
          items:
            $ref: '#/components/schemas/Base'
        modelo145:
          $ref: '#/components/schemas/Adjunto'
        modelo144:
          $ref: '#/components/schemas/Adjunto'
        certificadoSuspension:
          $ref: '#/components/schemas/Adjunto'
        modelo280:
          $ref: '#/components/schemas/Adjunto'
    Modelo144Response:
      type: object
      properties:
        allOf:
          $ref: '#/components/schemas/Adjunto'
        tiempoCompleto:
          type: boolean
        bases:
          type: array
          items:
            $ref: '#/components/schemas/Base'
    CertificadoSuspensionResponse:
      type: object
      properties:
        allOf:
          $ref: '#/components/schemas/Adjunto'
        fechaSuspension:
          type: string
          example: '2020-10-10'
  securitySchemes:
    accessCode:
      type: oauth2
      flows:
        authorizationCode:
          authorizationUrl: 'http://example.com/oauth/auth'
          tokenUrl: 'http://example.com/oauth/token'
          scopes:
            trabajador: acceso como trabajador
            empleado: acceso como empleado de ibermutua