openapi: 3.0.3
# Added by API Auto Mocking Plugin
servers:
  - description: SwaggerHub API Auto Mocking
    url: https://virtserver.swaggerhub.com/ilinRb/facade/1.0.0
info:
  version: "1.0.0"
  title: Facade for ClinicIQ System
  description: >-
    REST API for ClinicIQ.
paths:
  /v1/clients:
    get:
      summary: Получить клиента по телефону
      operationId: getClientByQuery
      parameters: 
        - $ref: '#/components/parameters/PageNumberQueryParameter'
        - $ref: '#/components/parameters/PageSizeQueryParameter'
        - $ref: '#/components/parameters/UserIdHeaderParameter'
        - $ref: '#/components/parameters/PhoneListQueryParameter'
      security: 
        - password: [read]
      responses:
        '200':
          description: Найденные пациенты
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ClientSimplePagedList'
        '401':
          $ref: '#/components/responses/UnauthorizedError'                        
        '404':
          $ref: '#/components/responses/NotFound'
        '5XX':
          $ref: '#/components/responses/ServerError'
  /v1/clients/{clientId}/plan/{taskId}:
    get:
      summary: Получить план лечения для конкретного зуба
      operationId: getTreatmentPlanByClientIdAndToothId
      parameters: 
      - $ref: '#/components/parameters/UserIdHeaderParameter'
      - $ref: '#/components/parameters/ClientIdPathParameter'
      - name: taskId
        in: path
        description: Идентификатор этапа лечения
        required: true
        schema:
          type: integer
          format: int32
      security: 
        - password: [read]
      responses:
        '200':
          description: Найденный план лечения
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TreatmentPlanTaskPageResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'                
        '404':
          $ref: '#/components/responses/NotFound'
        '5XX':
          $ref: '#/components/responses/ServerError'
  /v1/branches:
    get:
      summary: Получить список филиалов
      operationId: getAllBranchesByQuery
      parameters:
        - $ref: '#/components/parameters/PageNumberQueryParameter'
        - $ref: '#/components/parameters/PageSizeQueryParameter'      
        - $ref: '#/components/parameters/UserIdHeaderParameter'
        - $ref: '#/components/parameters/ClinicIdListQueryParameter'
      security: 
        - password: [read]
      responses:
        '200':
          description: Найденный план лечения
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ClinicPagedList'
        '401':
          $ref: '#/components/responses/UnauthorizedError'                
        '404':
          $ref: '#/components/responses/NotFound'
        '5XX':
          $ref: '#/components/responses/ServerError'
  /v1/doctors:
    get:
      summary: Получить список докторов 
      operationId: getAllClinicEmployeesByQuery
      parameters:
        - $ref: '#/components/parameters/PageNumberQueryParameter'
        - $ref: '#/components/parameters/PageSizeQueryParameter'
        - $ref: '#/components/parameters/UserIdHeaderParameter'      
        - $ref: '#/components/parameters/ClinicEmployeeIdListQueryParameter'
      security: 
        - password: [read]
      responses:
        '200':
          description: Найденный план лечения
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ClinicEmployeePagedList'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          $ref: '#/components/responses/NotFound'
        '5XX':
          $ref: '#/components/responses/ServerError'
  /v1/clients/{clientId}/visits:
    get:
      summary: Получить список визитов 
      operationId: getAllVisitsByClientId
      parameters:
        - $ref: '#/components/parameters/PageNumberQueryParameter'
        - $ref: '#/components/parameters/PageSizeQueryParameter'      
        - $ref: '#/components/parameters/UserIdHeaderParameter'      
        - $ref: '#/components/parameters/ClientIdPathParameter'
        - $ref: '#/components/parameters/StatusIdListQueryParameter'
      security: 
        - password: [read]
      responses:
        '200':
          description: Список визитов
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VisitAltPagedList'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          $ref: '#/components/responses/NotFound'
        '5XX':
          $ref: '#/components/responses/ServerError'
  /v1/clients/{clientId}/visits/{visitId}:
    get:
      summary: Получить детали по визиту 
      operationId: getVisitByClientIdAndVisitId
      parameters: 
        - $ref: '#/components/parameters/UserIdHeaderParameter'
        - $ref: '#/components/parameters/ClientIdPathParameter'
        - name: visitId
          in: path
          description: Идентификатор визита 
          required: true
          schema:
            type: integer
            format: int32          
      security: 
        - password: [read]
      responses:
        '200':
          description: Детали по визиту
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VisitAltDetPaged'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          $ref: '#/components/responses/NotFound'
        '5XX':
          $ref: '#/components/responses/ServerError'
  /v1/clinics/{clinicId}/schedule:
    get:
      summary: Получить детали по визиту 
      operationId: getScheduleByClinicIdAndDocId
      parameters: 
        - $ref: '#/components/parameters/UserIdHeaderParameter'
        - $ref: '#/components/parameters/ClinicIdPathParameter'
      security: 
        - password: [read]
      responses:
        '200':
          description: Детали по визиту
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WorkItemBatchPagedList'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          $ref: '#/components/responses/NotFound'
        '5XX':
          $ref: '#/components/responses/ServerError'
  /v1/clinics/{clinicId}/visits:
    get:
      summary: Получить визиты клиники 
      operationId: getVisitsByQuery
      parameters: 
        - $ref: '#/components/parameters/PageNumberQueryParameter'
        - $ref: '#/components/parameters/PageSizeQueryParameter'      
        - $ref: '#/components/parameters/UserIdHeaderParameter'            
        - $ref: '#/components/parameters/ClinicIdPathParameter'
        - $ref: '#/components/parameters/StatusIdListQueryParameter'
      security: 
      - password: [read]
      responses:
        '200':
          description: Детали по визиту
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WorkItemPagedList'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          $ref: '#/components/responses/NotFound'
        '5XX':
          $ref: '#/components/responses/ServerError'
components:
  responses:
    UnauthorizedError:
      description: Authentication information is missing or invalid
      headers:
        WWW_Authenticate:
          schema:
            type: string
    NotFound:
      description: The specified resource was not found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'         
    ServerError:
      description: An Unexpected Error was occured on server side
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'         
  parameters:
    PageNumberQueryParameter:
      name: pageNumber
      in: query
      description: Page Number
      required: false
      schema:
        type: integer
        format: int32
        default: 1
    PageSizeQueryParameter:
      name: pageSize
      in: query
      description: Page Size
      required: false
      schema:
        type: integer
        format: int32
        default: 25
    UserIdHeaderParameter:
      name: userId
      in: header
      description: Id пользователя
      required: false
      schema:
        type: integer
        format: int32
    PhoneListQueryParameter:
      name: phone
      in: query
      description: Номер телефона клиента
      required: false
      schema:
        type: array
        items:
          type: string
          format: phone    
    ClinicIdPathParameter:
      name: clinicId
      in: path
      description: Идентификатор клиники 
      required: true
      schema:
        type: integer
        format: int32
    ClinicIdListQueryParameter:
      name: id
      in: query
      description: Идентификаторы клиники 
      required: false
      schema:
        type: array
        items:
          type: integer
          format: int32
    ClinicEmployeeIdListQueryParameter:
      name: ClinicEmployeeId
      in: query
      description: Идентификаторы докторов клиники
      required: false
      schema:
        type: array
        items:
          type: integer
          format: int32      
    StatusIdListQueryParameter:
      name: statusId
      in: query
      description: Статусы визитов 
      required: false
      schema:
        type: array
        items:
          $ref: '#/components/schemas/VisitStatus'
    ClientIdPathParameter:
      name: clientId
      in: path
      description: Идентификатор пациента клиники 
      required: true
      schema:
        type: integer
        format: int32
  schemas:
    BaseResult:
      type: object
      properties:
        resultCode:
          type: integer
          format: int32
        resultMessage:
          type: string
    Error:
      type: object
      properties:
        result:
          $ref: '#/components/schemas/BaseResult'      
    PageInfo:
      type: object
      properties:
        total:
          type: integer
          format: int32
        page:
          type: integer
          format: int32
        pageSize:
          type: integer
          format: int32
          default: 100
        sortField:
          type: string
        sortDirection:
          type: string
    HistoryObject:
      type: object
      properties:
        createdTime:
          type: string
          format: date-time
        changedTime:
          type: string
          format: date-time
        createdBy:
          type: integer
          format: int32
        changedBy:
          type: integer
          format: int32
    NamedData:
      type: object
      properties:
        id:
          type: integer
          format: int32
        uuid:
          type: integer
          format: int64
        typeId:
          type: integer
          format: int32
        value:
          type: string
    Task:
      type: object
      properties:
        id:
          type: integer
          format: int32      
        toothNumber:
          type: integer
          format: int32
        taskStatus:
          $ref: '#/components/schemas/TaskStatus'
        serviceCode:
          type: array
          description: Код услуг по которой проходит лечение зуба
          items:
            type: string
            default: 'А16.07.002.011'
        diagnosCode:
          type: array
          description: Код диагноза зуба
          items:
            type: integer
            format: int32
            default: 0
        cost:
          type: number
          format: float
          description: Стоимость лечения
        treatmentDuration:
          type: integer
          format: int32
          description: Длительность лечения в днях
        appointment:
          type: string
          format: date-time
          description: Назначенная дата лечения
        recomendation:
          type: string
          description: Рекомендация к лечению зуба
        status:
          $ref: '#/components/schemas/TreatmentStatus'
        type:
          $ref: '#/components/schemas/VisitType'
        appointmentVisitId:
          type: integer
          format: int32
          description: Идентификатор назаченного визита
    TaskStatus:
      type: string
      description: Статус этапа лечения зуба
      enum: 
            - ACTIVE
            - CREATED
            - CANCELED
            - COMPLETED
    TreatmentStatus:
      type: string
      description: Статус этапа работ по зубу
      enum:
            - NOT_DEFINED
            - WARNING
            - ALARM
            - TO_BE_CONTINUE
            - EXPERT
            - TEMPORARY_FILLING
            - XRAY_CONTROL
            - CURED
            - UNDEFINED
    VisitType:
      type: string
      description: Тип назначенного визита
      enum:
            - TOOTH
            - HYGIENIC
            - WHITENING
    VisitStatus:
      type: string
      description:  Статус визита
      enum:
        - CREATED
        - COMPLETED
        - BUFFER
        - BUFFER_SYSTEM
        - BUFFER_CREATED
        - CANCELED
        - REPLACED
    Invoice:
      type: object
      description: Выставленный счет за лечение зуба
      properties:
        id:
          type: integer
          format: int32
        totalSum:
          type: number
          format: float
          description: Сумма счета за лечение зуба
        paidSum:
          type: number
          format: float
          description: Оплаченная сумма
        discount:
          type: number
          format: float
          description: Дискаунт по счету
        services:
          type: array
          items:
            $ref: '#/components/schemas/ServiceItem'
        startedAt:
          type: string
          format: date-time
        expiresAt:
          type: string
          format: date-time
    ServiceItem:
      type: object
      description: Пункты счета - сервисы из Прайс-листа
      properties:
        quantity:
          type: integer
          format: int32
          default: 0
          description: Количество
        serviceCode:
          type: string
          description: Код услуги из Прайс-листа
        price:
          type: number
          format: float
        name:
          type: string
          description: Наименование услуги
    VisitBase:
      type: object
      properties:
        id:
          type: integer
          format: int32
        ClinicEmployee:
          $ref: '#/components/schemas/ClinicEmployee'
        clinic:
          $ref: '#/components/schemas/Clinic'
        type:
          $ref: '#/components/schemas/VisitType'
        status:
          $ref: '#/components/schemas/VisitStatus'
        dateTime:
          type: string
          format: date-time
          description: Время визита
    VisitAlt:
      type: object
      allOf:
        - $ref: '#/components/schemas/VisitBase'
        - type: object
          properties:
            teeth: 
              type: array
              items:
                $ref: '#/components/schemas/Tooth'
            roentgenImage:
              type: array
              items:
                $ref: '#/components/schemas/RoentgenImage'
        - type: object
          properties:
            invoice:
              $ref: '#/components/schemas/Invoice'
    Visit:
      type: object
      allOf:
        - $ref: '#/components/schemas/VisitBase'
        - type: object
          properties:
            ClinicEmployeeNote:
              type: string
              description: Заметки доктора
            roentgenImage:
              $ref: '#/components/schemas/RoentgenImage'
    ClinicCabinet:
      type: object
      properties:
        id:
          type: integer
          format: int32
        number:
          type: integer
          format: int32
        title:
          type: string
    WorkItem:
      type: object
      allOf:
        - $ref: '#/components/schemas/TimeInterval'
        - type: object
          properties:
            clinicCabinet:
              $ref: '#/components/schemas/ClinicCabinet'
            ClinicEmployeeId:
              type: integer
              format: int32
            assistantId:
              type: integer
              format: int32
            status:
              type: integer
              format: int32
            client:
              $ref: '#/components/schemas/ClientSimple'
            workOrderId:
              type: integer
              format: int32
            workOrderStatus:
              type: integer
              format: int32
            title:
              type: string
            comment:
              type: string
            preparationBeginTime:
              type: integer
              format: int32
            preparationEndTime:
              type: integer
              format: int32
            visitReCallTime:
              type: string
              format: date-time
            visitAddedToBufferTime:
              type: string
              format: date-time
            treatmentTaskId:
              type: integer
              format: int32
            photos:
              type: array
              items:
                $ref: '#/components/schemas/RoentgenImage'
            document:
              type: array
              items:
                $ref: '#/components/schemas/RoentgenImage'
            agreement:
              type: array
              items:
                $ref: '#/components/schemas/RoentgenImage'     
            reason:
              $ref: '#/components/schemas/Reason'
            replaceReasonId:
              type: integer
              format: int32
            replaceReasonComment:
              type: string
            relocationTime:
              type: string
              format: date-time
            relocationWorkItemId:
              type: integer
              format: int32
            visitArrivalTime:
              type: string
              format: date-time
            visitLeavingTime:
              type: string
              format: date-time
            recurringVisitId:
              type: integer
              format: int32
            advertisingTaskId:
              type: integer
              format: int32
            workItemBatchId:
              type: integer
              format: int32
            consultantId:
              type: integer
              format: int32
            clientNovice:
              type: boolean
              default: false
            byRecomendation:
              type: boolean
              default: false
            vipStatus:
              type: integer
              format: int32
            smsCount:
              type: integer
              format: int32
              default: 0
            versionId:
              type: integer
              format: int32
              default: 0     
            callId:
              type: string
            callComment:
              type: string
            priceAsked:
              type: boolean
            docComment1:
              type: string
            docComment2:
              type: string
            rgDescription:
              type: string
            photosDescription:
              type: string
    WorkItemBatch:
      type: object
      allOf:
        - type: object
          properties:
            id:
              type: integer
              format: int32
            cabinet:
              $ref: '#/components/schemas/ClinicCabinet'
            doctor:
              $ref: '#/components/schemas/ClinicEmployee'
            assistant:
              $ref: '#/components/schemas/ClinicEmployee'
            workItems:
              type: array
              items:
                $ref: '#/components/schemas/WorkItem'
            shiftsCount:
              type: integer
              format: int32
              default: 1
            originalBeginTime:
              type: string
              format: date-time
            originalEndTime:
              type: string
              format: date-time
            workDayItemId:
              type: integer
              format: int32
              default: 0
            systemInfo:
              type: string
        - $ref: '#/components/schemas/HistoryObject'
    RoentgenImage:
      type: object
      properties:
        id:
          type: integer
          format: int32
        url:
          type: string
          format: url
        comment:
          type: string
    Clinic:
      type: object
      allOf:
        - type: object
          properties:
            id:
              type: integer
              format: int32
            domain:
              type: string
            statusId:
              type: integer
              format: int32
            isDemo:
              type: boolean
            isNetwork:
              type: boolean
            clinicType:
              type: integer
              format: int32
            countryCode:
              type: string
            city:
              type: string
            title:
              type: string
        - $ref: '#/components/schemas/HistoryObject' 
    ClinicPersona:
      type: object
      allOf:
        - type: object
          properties:
            id:
              type: integer
              format: int32
            uuid:
              type: integer
              format: int64
            fname:
              type: string
            sname:
              type: string
            lname:
              type: string
            birthdate:
              type: string
              format: date
            sex:
              type: integer
              format: int32
            namedData:
              type: array
              items:
                $ref: '#/components/schemas/NamedData'
            dynamicData:
              type: object
              additionalProperties:
                type: string
            phoneNumber:
              type: string
              format: phone
            nationalNumber:
              type: integer
              format: int64
            phoneCountryCode:
              type: integer
              format: int32
            homeNationalNumber:
              type: integer
              format: int64
            homePhoneCountryCode:
              type: integer
              format: int32
            workNationalNumber:
              type: integer
              format: int64
            workPhoneCountryCode:
              type: integer
              format: int32
        - $ref: '#/components/schemas/HistoryObject'  
    ClinicEmployee:
      type: object
      allOf:
        - $ref: '#/components/schemas/ClinicPersona'
        - type: object
          properties:
            roleId:
              type: integer
              format: int32
            doctorSpecsId: 
              type: array
              items:
                type: integer
                format: int32
            status:
              type: integer
              format: int32
            hireDate:
              type: string
              format: date
            fireDate:
              type: string
              format: date
            shortName:
              type: string
            isDoctor:
              type: boolean
            user:
              $ref: '#/components/schemas/User'
    Role:
      type: object
      allOf:
        - type: object
          properties:
            id:
              type: integer
              format: int32
            keyId:
              type: integer
              format: int32
            uuid:
              type: integer
              format: int64
            permissionValues:
              type: object
              additionalProperties:
                type: string
        - $ref: '#/components/schemas/HistoryObject'
    User:
      type: object
      allOf:
        - type: object
          properties:
            authCode:
              type: integer
              format: int32
            domain:
              $ref: '#/components/schemas/Clinic'
            id:
              type: integer
              format: int32
            login:
              type: string
            password:
              type: string
              format: password
            passwordCreationDate:
              type: string
              format: date-time
            namedData:
              type: array
              items:
                $ref: '#/components/schemas/NamedData'
            uuid:
              type: integer
              format: int64
            employeeId:
              type: integer
              format: int32
            status:
              type: integer
              format: int32
            role:
              $ref: '#/components/schemas/Role'
            email:
              type: string
              format: email
            passVersion:
              type: integer
              format: int32
            isMaster:
              type: boolean
            network:
              $ref: '#/components/schemas/ClinicNetwork'
            isSupervisor:
              type: boolean
            impersonateUserId:
              type: integer
              format: int32
    ClinicNetwork:
      type: object
      properties:
        id:
          type: integer
          format: int32
        title:
          type: string
        name:
          type: string
        domains:
          type: array
          items:
            $ref: '#/components/schemas/Clinic'
    ClientSimple:
      type: object
      allOf:
        - $ref: '#/components/schemas/ClinicPersona'
        - type: object
          properties:
            vipStatus:
              type: integer
              format: int32
            status:
              type: integer
              format: int32
    TimeInterval:
      type: object
      properties:
        id:
          type: integer
          format: int32
        dateFrom:
          type: string
          format: date-time
        dateTo:
          type: string
          format: date-time
    ClinicEmployeeSpecialization:
      type: object
      properties:
        title:
          type: string
        id:
          type: integer
          format: int32
        catId:
          type: integer
          format: int32
    Reason:
      type: object
      properties:
        title:
          type: string
        id:
          type: integer
          format: int32
        catId:
          type: integer
          format: int32
        ClinicEmployeeSpecializations:
          type: array
          items:
            $ref: '#/components/schemas/ClinicEmployeeSpecialization'
    Tooth:
      type: object
      properties:
        number:
          type: integer
          format: int32
        notes:
          type: string
        diagnosCode:
          type: array
          items:
            type: integer
            format: int32
        images:
          type: array
          items:
            $ref: '#/components/schemas/RoentgenImage'
    TreatmentPlanTask:
      type: object
      properties:
        tooth:
          $ref: '#/components/schemas/Task'
        invoice:
          $ref: '#/components/schemas/Invoice'
        visit:
          $ref: '#/components/schemas/Visit'
    PageResponse:
      type: object
      properties:
        result:
          $ref: '#/components/schemas/BaseResult'      
        pageInfo:
          $ref: '#/components/schemas/PageInfo'
    TreatmentPlanTaskPageResponse:
      type: object
      allOf:
        - $ref: '#/components/schemas/PageResponse'
        - type: object
          properties:
            content:
              $ref: '#/components/schemas/TreatmentPlanTask'
    ClinicList:
      type: array
      items:
        $ref: '#/components/schemas/Clinic'
    ClinicEmployeeList:
      type: array
      items:
        $ref: '#/components/schemas/ClinicEmployee'
    WorkItemBatchList:
      type: array
      items:
        $ref: '#/components/schemas/WorkItemBatch'
    WorkItemList:
      type: array
      items:
        $ref: '#/components/schemas/WorkItem'
    WorkItemPagedList:
      type: object
      allOf:
        - $ref: '#/components/schemas/PageResponse'      
        - type: object
          properties:
            content:
              $ref: '#/components/schemas/WorkItemList'    
    WorkItemBatchPagedList:
      type: object
      allOf:
        - $ref: '#/components/schemas/PageResponse'      
        - type: object
          properties:
            content:
              $ref: '#/components/schemas/WorkItemBatchList'        
    ClinicEmployeePagedList:
      type: object
      allOf:
        - $ref: '#/components/schemas/PageResponse'      
        - type: object
          properties:
            content:
              $ref: '#/components/schemas/ClinicEmployeeList'        
    VisitAltList:
      type: array
      items:
        $ref: '#/components/schemas/VisitAlt'
    VisitAltPagedList:
      type: object
      allOf:
        - $ref: '#/components/schemas/PageResponse'
        - type: object
          properties:
            content:
              $ref: '#/components/schemas/VisitAltList'    
    VisitAltDetPaged:
      type: object
      allOf:
        - $ref: '#/components/schemas/PageResponse'
        - type: object
          properties:
            content:
              $ref: '#/components/schemas/VisitAlt'              
    ClinicPagedList:
      type: object
      allOf:
        - $ref: '#/components/schemas/PageResponse'
        - type: object
          properties:
            content:
              $ref: '#/components/schemas/ClinicList'          
    ClientSimpleList:
      type: array
      items:
        $ref: '#/components/schemas/ClientSimple'
    ClientSimplePageResponse:
      type: object
      allOf:
        - $ref: '#/components/schemas/PageResponse'
        - type: object
          properties:
            content:
              $ref: '#/components/schemas/ClientSimple'
    ClientSimplePagedList:
      type: object
      allOf:
        - $ref: '#/components/schemas/PageResponse'      
        - type: object
          properties:
            content:
              $ref: '#/components/schemas/ClientSimpleList'    
  securitySchemes:
    password:
      type: oauth2
      flows:
        password:
          tokenUrl: 'https://devtest.cliniciq.ru/facade/oauth/token'
          scopes:
            write: allows modifying resources
            read: allows reading resources