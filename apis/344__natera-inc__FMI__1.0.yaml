penapi: 3.0.1
info:
  title: FMI API
  description: This specification lists all the end-points used by FMI
  version: "1.0"
servers:
# Added by API Auto Mocking Plugin
  - description: SwaggerHub API Auto Mocking
    url: https://virtserver.swaggerhub.com/natera-inc/FMI/1.2
  - url: http://localhost:8686/lims-api/1.0
  - url: https://stage.natera.com:6540/1.0
paths:
  /user/login:
    post:
      tags:
        - Authentication
      description: HTTP Basic Authentication. Provides JWT token in a response which shall be used in further requests.
      security:
       - basicAuth: []
      responses:
        200:
          description: "Success"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/JwtImpl'
        401:
          description: "Bad credentials have been provided"
  /fmi/info/:
    get:
      tags:
        - Application Status
      description: Reports status and current versions of all significant Natera systems.
      parameters:
        - in: header
          name: tracking-id
          schema:
            type: string
            format: guid
          required: false
      responses:
        200:
          description: "Success"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AppStatus'
        400:
          description: "Bad Request. Provided filter criteria is not valid."
        401:
          description: "Authentication is required."
        404:
          description: "Resource not found"
  /fmi/monitoring-series/{monitoringSeriesId}:
    get:
      tags:
        - Monitoring Series
      description: Track the variant data design status
      parameters:
        - in: header
          name: tracking-id
          schema:
            type: string
            format: uuid
          required: false
        - in: path
          name: monitoringSeriesId
          required: true
          schema:
            type: string
          example: "101"
      responses:
        200:
          description: "Success"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FmiMonitoringSeries'
        400:
          description: "Bad Request. Provided filter criteria is not valid."
        401:
          description: "Authentication is required."
        404:
          description: "Resource not found"
    put:
      tags:
        - Monitoring Series
      description: Send patient specific variant data from FMI
      parameters:
        - in: header
          name: tracking-id
          schema:
            type: string
            format: uuid
          required: false
        - in: path
          name: monitoringSeriesId
          required: true
          schema:
            type: string
          example: "101"
      requestBody:
        description: Patient specific variant data
        content: 
          'application/json':
            schema:
              $ref: '#/components/schemas/FmiMonitoringSeriesUpdateRequest'
            example:
              cancelled: true
        required: true
      responses:
        200:
          description: "Success"
        400:
          description: "Bad Request. Provided filter criteria is not valid."
        401:
          description: "Authentication is required."
        404:
          description: "Resource not found"
  /fmi/monitoring-series:
    get:
      tags:
        - Monitoring Series
      description: Track the variant data design status
      parameters:
        - in: header
          name: tracking-id
          schema:
            type: string
            format: uuid
          required: false
        - in: query
          name: studyId
          required: true
          description: "Filter criteria"
          schema:
            type: string
          example: "121"
      responses:
        200:
          description: "Success"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FmiMonitoringSeriesListResponse'
        400:
          description: "Bad Request. Provided filter criteria is not valid."
        401:
          description: "Authentication is required."
        404:
          description: "Resource not found"
    post:
      tags:
        - Monitoring Series
      description: Send patient specific variant data from FMI
      parameters:
        - in: header
          name: tracking-id
          schema:
            type: string
            format: uuid
          required: false
      requestBody:
        description: Patient specific variant data
        content: 
          'application/json':
            schema:
              $ref: '#/components/schemas/FmiMonitoringSeries'
            examples:
              valid:
                value:
                  monitoringSeriesId: "101"
                  studyInfo:
                    partnerName: "Jane"
                    partnerStudyId: "121"
                    fmiStudyId: "131"
                    visitType: "value"
                    treatmentCycle: "value"
                    treatment: "value"
                    daysPostTreatmentCycleInitiation: 200
                    daysSinceRecentTreatment: 100
                  patientInfo:
                    partnerSubjectId: "141"
                    yearOfBirth: 1950
                    biologicalSex: MALE
                    initials: "J. D. S."
                    dateOfBirth: "1950-11-04"
                  pipelineVersion: "2.5"
                  snp: 
                  - genotype: "RR"
                    confidenceScore: "value"
                    genotypeStatus: 0.5
                    frequency: 0.5
                    rsid: "value"
                  pharma:
                    subjectId: "131"
                    id: "141"
                    protocolId: "151"
                    siteId: "161"
                  variants:
                  - chromosome: "chr1"
                    position: "43806206"
                    reference: "G"
                    alternate: "C"
                    nearbyMutations:
                    - chromosome: "chr1"
                      position: "43806206"
                      reference: "G"
                      alternate: "C"
              invalid:
                value:
                  monitoringSeriesId: null
                  studyInfo:
                    partnerName: "Jane"
                    partnerStudyId: "121"
                    fmiStudyId: "131"
                    visitType: "value"
                    treatmentCycle: "value"
                    treatment: "value"
                    daysPostTreatmentCycleInitiation: 200
                    daysSinceRecentTreatment: 100
                  patientInfo:
                    partnerSubjectId: "141"
                    yearOfBirth: 1950
                    biologicalSex: MALE
                    initials: "J. D. S."
                    dateOfBirth: "1950-11-04"
                  pipelineVersion: "2.5"
                  snp:
                  - genotype: "RR"
                    confidenceScore: "value"
                    genotypeStatus: 1.5
                    frequency: 1.5
                    rsid: "value"
                  pharma:
                    pharmaSubjectId: "131"
                    pharmaId: "141"
                    pharmaProtocolId: "151"
                    pharmaSiteId: "161"
                  variants:
                  - chromosome: "chr1"
                    position: "43806206"
                    reference: "G"
                    alternate: "C"
                    nearbyMutations:
                    - chromosome: "chr1"
                      position: "43806206"
                      reference: "G"
                      alternate: "C"
        required: true
      responses:
        200:
          description: "Success"
        400:
          description: "Bad Request. Provided filter criteria is not valid."
        401:
          description: "Authentication is required."
        404:
          description: "Resource not found"
  /fmi/monitoring-case/status:
    post:
      tags:
        - Monitoring Case
      description: Track monitoring Monitoring Cases throughout the analysis workflow
      parameters:
        - in: header
          name: tracking-id
          schema:
            type: string
            format: uuid
          required: false
      requestBody:
        description: Filtering Criteria (At least one filter criteria is required)
        content: 
          'application/json':
            schema:
              $ref: '#/components/schemas/FmiMonitoringCaseStatusRequest'
            example:
              caseId: 1001
              createdAfter: "2019-11-04T14:16:37"
              createdBefore: "2021-01-01T14:16:37"
              status: "SAMPLE_RECEIVED"
              statusTransitionAfter: "2019-11-04T14:16:37"
              statusTransitionBefore: null
              studyId: null
              monitoringSeriesId: "101"
        required: true
      responses:
        200:
          description: "Success"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FmiMonitoringCaseStatusResponse'
        400:
          description: "Bad Request. Provided filter criteria is not valid."
        401:
          description: "Authentication is required."
  /fmi/monitoring-case/{caseId}:
    get:
      tags:
        - Monitoring Case
      description: Delivering monitoring Monitoring Case result
      parameters:
        - in: header
          name: tracking-id
          schema:
            type: string
            format: uuid
          required: false
        - in: path
          name: caseId
          required: true
          schema:
            type: "integer"
            format: "int64"
          example: 2000001
      responses:
        200:
          description: "Success"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FmiMonitoringCaseResponse'
        400:
          description: "Bad Request. Provided filter criteria is not valid."
        401:
          description: "Authentication is required."
  /fmi/monitoring-case:
    post:
      tags:
        - Monitoring Case
      description: Delivering Monitoring Case results
      parameters:
        - in: header
          name: tracking-id
          schema:
            type: string
            format: uuid
          required: false
      requestBody:
        description: List of CaseFile ids
        content:
          'application/json':
            schema:
              type: array
              items:
                type: "integer"
                format: "int64"
            example:
              [2000001, 2000402]
        required: true
      responses:
        200:
          description: "Success"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FmiMonitoringCaseListResponse'
        400:
          description: "Bad Request. Provided filter criteria is not valid."
        401:
          description: "Authentication is required."
  /report/lab-director/{labDirectorId}:
    get:
      tags:
        - Report
      description: Returning Lab Director Information
      parameters:
        - in: header
          name: tracking-id
          schema:
            type: string
            format: uuid
          required: false
        - in: path
          name: labDirectorId
          required: true
          schema:
            type: integer
            format: "int64"
          example: 101
      responses:
        200:
          description: "Success"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LabDirectorResponse'
              example:
                id: 1
                description: "Jane Doe, Ph.D., Senior Laboratory Director"
                signature: "<base64 string>"
        400:
          description: "Bad Request. Provided filter criteria is not valid."
        401:
          description: "Authentication is required."
components:
  schemas:
    FmiMonitoringSeries:
      type: "object"
      required:
      - monitoringSeriesId
      - baselineVariant
      - pharma
      properties:
        monitoringSeriesId:
          type: "string"
        baselineQc:
          type: "string"
          description: "Should all monitoring samples associated with this 'Monitoring Series ID' will be TNPed immediately ?"
          readOnly: true
          enum:
          - PASSED
          - FAILED
        cancelled:
          type: "boolean"
          readOnly: true
        pipelineVersion:
          type: "string"
          description: "Pipeline version in format of MAJOR.SUBMAJOR"
        snp:
          type: array
          items: 
            $ref: '#/components/schemas/FmiSnpData'
        pharma:
          $ref: '#/components/schemas/FmiPharmaInfo'
        studyInfo:
          $ref: '#/components/schemas/FmiStudyInfo'
        patientInfo:
          $ref: '#/components/schemas/FmiPatientInfo'
        status:
          type: "string"
          description: "Primer Pipeline Status - used in response, but not in request"
          readOnly: true
          enum:
          - PRIMERS_ANALYSING # variants have been received and assay is being designed
          - AWAITING_PRIMERS # assay has been designed and awaiting manufacture
          - PRIMERS_READY # assay has been manufactured, ready for monitoring samples
          - INVALID_DATA # invalid variant or assay design
        variants:
          type: array
          items:
            $ref: '#/components/schemas/FmiSeriesVariant'
    FmiMonitoringSeriesUpdateRequest:
      type: "object"
      properties:
        cancelled:
          type: "boolean"
    FmiSnpData:
      allOf:
        - $ref: '#/components/schemas/CommonVariant'
        - type: "object"
          properties:
            genotype:
              type: "string"
              description: "one of the four types (RR, MM, RM, Uncertain)"
              enum: 
              - PR
              - MM
              - RM
              - UNCERTAIN
            confidenceScore:
              type: "string"
              description: "Confidence Score for the call per each SNP in the tracer list"
            genotypeStatus:
              type: "number"
              format: "double"
              description: "uncertain – CNV info to be incorporated into determining uncertainty - double [0,1]"
              minimum: 0
              maximum: 1
            frequency:
              type: "number"
              format: "double"
              minimum: 0
              maximum: 1
            rsid:
              type: "string"
    FmiSeriesVariant:
      allOf:
        - $ref: '#/components/schemas/CommonVariant'
        - type: "object"
          properties:
            prioritizationCategory:
              type: "string"
              description: "provides some groupings of variants"
              example: "significant"
            alleleFraction:
              type: "number"
              format: "double"
              minimum: 0
              maximum: 1
            category:
              type: "string"
              readOnly: true
              enum:
              - TARGETED
              - NON_TARGETED
              - FAILED
              - DROPPED_OUT_VARIANTS
            nearbyMutations:
              type: "array"
              items:
                $ref: '#/components/schemas/CommonVariant'
            score:
              type: "number"
            somaticScore:
              type: "number"
              description: "Likelihood that the variant is somatic"
              minimum: 0
              maximum: 1
    FmiMonitoringSeriesListResponse:
      type: "object"
      properties:
        statuses:
          type: array
          items:
            $ref: '#/components/schemas/FmiMonitoringSeries'
    FmiMonitoringCaseStatusRequest:
      type: "object"
      properties:
        caseId:
          type: "integer"
          format: "int64"
        createdAfter:
          type: "string"
          format: "date-time"
        createdBefore:
          type: "string"
          format: "date-time"
        status:
          type: "string"
          description: "Case Status"
          enum:
          - SAMPLE_RECEIVED 
          - IN_LAB_PROGRESS
          - ANALYZING_RUN
          - ANALYZING_SAMPLE
          - RESULTS_READY
        statusTransitionAfter:
          type: "string"
          format: "date-time"
        statusTransitionBefore:
          type: "string"
          format: "date-time"
        studyId:
          type: "string"
        monitoringSeriesId:
          type: "string"
    FmiMonitoringCaseStatusResponse:
      type: "object"
      properties:
        statuses:
          type: array
          items:
            type: "object"
            properties:
              monitoringSeriesId:
                type: "string"
              studyId:
                type: "string"
              caseId:
                type: "integer"
                format: "int64"
              statusHistory:
                type: array
                description: "the items are provided in descending by date order so that the first state is the current state"
                items:
                  type: "object"
                  properties:
                    status:
                      type: "string"
                      description: "Case Status"
                      enum:
                      - SAMPLE_RECEIVED
                      - IN_LAB_PROGRESS
                      - ANALYZING_RUN
                      - ANALYZING_SAMPLE
                      - RESULTS_READY
                    date:
                      type: "string"
                      format: "date-time"
              miState:
                type: "string"
                description: "Missing Information State - a parallel state along with the case status."
                enum:
                - DETECTED
                - NOT_DETECTED
              miDetails:
                type: array
                items:
                  type: "string"
    FmiMonitoringCaseListResponse:
      type: "object"
      properties:
        statuses:
          type: array
          items:
            $ref: '#/components/schemas/FmiMonitoringCaseResponse'
    FmiMonitoringCaseResponse:
      type: "object"
      properties:
        monitoringSeriesId:
          type: "string"
        caseId:
          type: "integer"
          format: "int64"
        studyInfo:
          $ref: '#/components/schemas/FmiStudyInfo'
        orderInfo:
          $ref: '#/components/schemas/FmiOrderInfo'
        patientInfo:
          $ref: '#/components/schemas/FmiPatientInfo'
        clinicalNotes:
          type: "string"
        snpData:
          type: array
          items: 
            $ref: '#/components/schemas/FmiSnpData'
        variantLevelResults:
          type: array
          items:
            $ref: '#/components/schemas/SampleResultVariant'
        ctDNAresults:
          type: "object"
          properties:
            QC:
              type: "string"
              enum:
              - PASS
              - FAIL
            plasmaVolume_mL:
              type: "number"
              format: "double"
            totalMass_ng:
              type: "number"
              format: "double"
            massFractionIntoLib:
              type: "number"
              format: "double"
            overallCall:
              type: "string"
              enum:
              - POSITIVE
              - NEGATIVE
            meanAlleleFraction:
              type: "number"
              format: "double"
            mtmPerMl:
              type: "number"
              format: "double"
            positiveMutations:
              type: "integer"
              format: "int64"
            tnpCode:
              type: "string"
              enum:
              - NC_REDRAW_QC_FAILURE          # QC failure, redraw recommended 
              - NC_OTHER                      # No call, redraw not recommended 
              - TNP_ID_DISCREPANCY            # ID discrepancy 
              - TNP_REDRAW_SPECIMEN_AGE       # Sample is too old 
              - TNP_REDRAW_SHORT_DRAW         # Short draw 
              - TNP_REDRAW_WRONG_TUBES        # Wrong collection tube 
              - TNP_REDRAW_SAMPLE_DAMAGED     # Sample is damaged 
              - TNP_REDRAW_INSUFFICIENT_DNA   # Insufficient DNA 
              - TNP_REDRAW_SEVERELY_HEMOLYZED # Severely hemolyzed 
              - TNP_REDRAW_QUANTIT_QC_FAILED  # Quant-iT QC failure 
              - TNP_REDRAW_LAB_ERROR          # Lab error (other) - ctDNA 
              - TNP_TEST_CANCELLED            # Ordered test was cancelled 
              - TNP_SAMPLES_SENT_IN_ERROR     # Samples were sent in error 
              - TNP_MISSING_INFORMATION       # Case is missing required information 
              - TNP_OTHER                     # Test not performed (other)
        report:
          type: "object"
          properties:
            reportDate:
              type: "string"
              format: "date-time"
              description: "Defines the date of creation and signdate"
        pipelineVersion:
          type: "string"
          description: "Pipeline version in format of MAJOR.SUBMAJOR"
        signature:
          type: "string"
          description: "HATEOAS link"
          example: "https://localhost/1.0/report/labDirector/601"
    FmiPharmaInfo:
      type: "object"
      properties:
        subjectId:
          type: "string"
        id:
          type: "string"
        protocolId:
          type: "string"
        siteId:
          type: "string"
    FmiStudyInfo:
      type: "object"
      properties:
        partnerName:
          type: "string"
        partnerStudyId:
          type: "string"
        fmiStudyId:
          type: "string"
        visitType:
          type: "string"
        treatmentCycle:
          type: "string"
        treatment:
          type: "string"
        daysPostTreatmentCycleInitiation:
          type: "integer"
          format: "int64"
        daysSinceRecentTreatment:
          type: "integer"
          format: "int64"
    FmiOrderInfo:
      type: "object"
      properties:
        sampleCollectionDate:
          type: "string"
          format: "date-time"
        receivedDate:
          type: "string"
          format: "date-time"
        siteId:
          type: "string"
        senderName:
          type: "string"
        senderEmail:
          type: "string"
        clinicianName:
          type: "string"
        partnerSpecimenIds:
          type: array
          items:
            type: "string"
    FmiPatientInfo:
      type: "object"
      properties:
        partnerSubjectId:
          type: "string"
        yearOfBirth:
          type: "integer"
          format: "int64"
        biologicalSex:
          type: "string"
          enum:
          - MALE
          - FEMALE
        initials:
          type: "string"
        dateOfBirth:
          type: "string"
          format: "date-time"
    CommonVariant:
      type: object
      properties:
        chromosome:
          type: "string"
        position:
          type: "integer"
        reference:
          type: "string"
          example: "sequence of ATCG"
        alternate:
          type: "string"
          example: "sequence of ATCG"
    SampleResultVariant:
      allOf:
        - $ref: '#/components/schemas/CommonVariant'
        - type: "object"
          properties:
            tumorMoleculesPerMl:
              type: "number"
              format: "double"
            availability:
              type: "string"
              enum:
              - PRESENT
              - ABSENT
            alleleRatio:
              type: "number"
            targetCall:
              type: "string"
              enum:
              - POSITIVE
              - NEGATIVE
              - NOCALL    # failed / dropped out variants
              - NA        # Non-targetted
    LabDirectorResponse:
      type: "object"
      properties:
        id:
          type: "integer"
          format: "int64"
        name:
          type: "string"
        signature:
          type: "string"
    AppStatus:
      type: "object"
      properties:
        apiVersion:
          type: "string"
        systems:
          type: array
          items:
            type: "object"
            properties:
              name:
                type: "string"
              status:
                type: "string"
                enum:
                - UP
                - DOWN
              systemVersion:
                type: "string"
                description: "API version in format of MAJOR.SUBMAJOR.MINOR.PATCH"
    JwtImpl:
      type: "object"
      properties:
        claims:
          type: "string"
          description: "json with user properties"
        encoded:
          type: "string"
          description: "token for Jwt authentication"
  securitySchemes:
    basicAuth:
      type: http
      scheme: basic
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
security:
  - bearerAuth: []