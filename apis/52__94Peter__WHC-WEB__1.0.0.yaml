penapi: 3.0.0
info:
  version: 1.0.0
  title: Kalimasi User API
  description: "提供給通用能源監控系統的API，做為"

servers:
# Added by API Auto Mocking Plugin
  - description: SwaggerHub API Auto Mocking
    url: https://virtserver.swaggerhub.com/pet94/ZAPI-User/1.0.0

tags:
  - name: auth
    description: 身份驗證相關API
  - name: budget
    description: 預算API
  - name: receipt
    description: 收據發票API
  - name: account
    description: 帳務API
  - name: accTerm
    description: 會計科目API
  - name: transfer
    description: 轉帳API
    
paths:
  /v1/login:
    post:
      tags: [auth]
      summary: 登入
      operationId: login
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Login'
      responses:
        '200':
          description: ok
          content:
            application/json:
              schema:
                type: object
                properties:
                  token:
                    type: string
                  permission:
                    type: string
        '401':
          description: 無效的firebase token
  /v1/app:
    get:
      tags: [auth]
      summary: 檢查app版本
      operationId: get-app
      parameters:
        - in: query
          name: p
          required: true
          schema:
            type: string
            enum: ["vb"]
          description: platform
      responses:
        '200':
          description: ok
        '403':
          description: 禁止使用
  /v1/accTerm:
    get:
      tags: [accTerm]
      summary: 取得會計科目
      operationId: get-accTerm
      security:
        - ApiKeyAuth: []
      parameters:
        - in: query
          name: t
          required: true
          schema:
            type: string
            enum: ["assets","debt","fund","income","expenses"]
          description: 類型
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GetAccTermList'
        '400':
          description: bad request
        '500':
          description: internal server error
  /v1/budget:
    get:
      tags: [budget]
      summary: 取得預算清單
      operationId: get-budget
      security:
        - ApiKeyAuth: []
      parameters:
        - in: query
          name: year
          required: false
          schema:
            type: integer
          description: 年度
        - in: query
          name: title
          required: false
          schema:
            type: string
          description: 抬頭
        - in: query
          name: type
          required: false
          schema:
            type: string
            enum: [project, year]
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GetBudget'
        '204':
          description: no content
        '400':
          description: bad request
        '500':
          description: internal server error
    post:
      tags: [budget]
      summary: 建立預算(年度/專案)
      operationId: post-budget
      security:
        - ApiKeyAuth: []
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PostBudget'
      responses:
        '200':
          description: OK
        '400':
          description: bad request
        '500':
          description: internal server error
  /v1/budget/{ID}:
    get:
      tags: [budget]
      summary: 預算詳細
      operationId: get-budget-detail
      security:
        - ApiKeyAuth: []
      parameters:
        - in: path
          name: ID
          required: true
          schema:
            type: string
          description: budgetID
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BudgetDetail'
        '404':
          description: not found
        '400':
          description: bad request
        '500':
          description: internal server error
    put:
      tags: [budget]
      summary: 修改預算
      operationId: pub-budget
      security:
        - ApiKeyAuth: []
      parameters:
        - in: path
          name: ID
          required: true
          schema:
            type: string
          description: budgetID
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ModifyBudget'
      responses:
        '200':
          description: OK
        '400':
          description: bad request
        '500':
          description: internal server error
    delete:
      tags: [budget]
      summary: 刪除預算
      operationId: delete-budget
      security:
        - ApiKeyAuth: []
      parameters:
        - in: path
          name: ID
          required: true
          schema:
            type: string
          description: budgetID
      responses:
        '200':
          description: OK
        '404':
          description: 找不到預算
        '500':
          description: internal server error
  /v1/receipt:
    post:
      tags: [receipt]
      summary: 建立收據
      operationId: create-receipt
      security:
        - ApiKeyAuth: []
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PostReceipt'
      responses:
        '200':
          description: OK
        '400':
          description: bad request
        '500':
          description: internal server error
    get:
      tags: [receipt]
      summary: 收據清單
      operationId: get-receipt
      security:
        - ApiKeyAuth: []
      parameters:
        - in: query
          name: at
          required: false
          schema:
            type: string
            enum: ["income","expenses"]
          description: 類型 (收入,支出)
        - in: query
          name: t
          required: false
          schema:
            type: string
            enum: ["electronic","triplicate","duplicate"]
          description: 發票類型 (電子,三聯,二聯)
        - in: query
          name: number
          required: false
          schema:
            type: string
          description: 發票號碼
        - in: query
          name: budget
          required: false
          schema:
            type: string
          description: 預算/專案ID
        - in: query
          name: sd
          required: false
          schema:
            type: string
          description: 起始日期
        - in: query
          name: ed
          required: false
          schema:
            type: string
          description: 結束日期
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GetReceiptPagination'
        '204':
          description: no content
        '400':
          description: bad request
        '500':
          description: internal server error
  /v1/receipt/{ID}:
    get:
      tags: [receipt]
      summary: 預算發票
      operationId: get-receipt-detail
      security:
        - ApiKeyAuth: []
      parameters:
        - in: path
          name: ID
          required: true
          schema:
            type: string
          description: 發票ID
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ReceiptDetail'
        '404':
          description: not found
        '400':
          description: bad request
        '500':
          description: internal server error
    put:
      tags: [receipt]
      summary: 修改發票
      operationId: pub-receipt
      security:
        - ApiKeyAuth: []
      parameters:
        - in: path
          name: ID
          required: true
          schema:
            type: string
          description: receiptID
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ReceiptDetail'
      responses:
        '200':
          description: OK
        '400':
          description: bad request
        '500':
          description: internal server error
    delete:
      tags: [receipt]
      summary: 刪除發票
      operationId: delete-receipt
      security:
        - ApiKeyAuth: []
      parameters:
        - in: path
          name: ID
          required: true
          schema:
            type: string
          description: 發票ID
      responses:
        '200':
          description: OK
        '404':
          description: 找不到發票
        '500':
          description: internal server error
  /v1/transfer:
    post:
      tags: [transfer]
      summary: 建立轉帳資料
      operationId: create-transfer
      security:
        - ApiKeyAuth: []
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PostTransfer'
      responses:
        '200':
          description: OK
        '400':
          description: bad request
        '500':
          description: internal server error
    get:
      tags: [transfer]
      summary: 轉帳清單
      operationId: get-transfer
      security:
        - ApiKeyAuth: []
      parameters:
        - in: query
          name: s
          required: false
          schema:
            type: string
          description: 摘要關鍵字
        - in: query
          name: sd
          required: false
          schema:
            type: string
          description: 日期
        - in: query
          name: budget
          required: false
          schema:
            type: string
          description: 預算Id
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GetTransferPagination'
        '204':
          description: no content
        '400':
          description: bad request
        '500':
          description: internal server error
  /v1/transfer/{ID}:
    get:
      tags: [transfer]
      summary: 轉帳明細資料
      operationId: get-trnasfer-detail
      security:
        - ApiKeyAuth: []
      parameters:
        - in: path
          name: ID
          required: true
          schema:
            type: string
          description: transferID
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TransferDetail'
        '404':
          description: not found
        '400':
          description: bad request
        '500':
          description: internal server error
    put:
      tags: [transfer]
      summary: 修改轉資
      operationId: put-transfer
      security:
        - ApiKeyAuth: []
      parameters:
        - in: path
          name: ID
          required: true
          schema:
            type: string
          description: transferID
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PutTransfer'
      responses:
        '200':
          description: OK
        '400':
          description: bad request
        '500':
          description: internal server error
    delete:
      tags: [transfer]
      summary: 刪除發票
      operationId: delete-transfer
      security:
        - ApiKeyAuth: []
      parameters:
        - in: path
          name: ID
          required: true
          schema:
            type: string
          description: 轉帳ID
      responses:
        '200':
          description: OK
        '404':
          description: 找不到發票
        '500':
          description: internal server error
components:
  schemas:
    Login:
      type: object
      properties:
        account:
          type: string
          description: email帳號
        pwd:
          type: string
        company:
          type: string
          description: 統一編號
    GetTransferPagination:
      type: object
      properties:
        rows:
          type: array
          items:
            type: object
            properties:
              id:
                type: string
                description: transferID
              budget:
                type: string
                description: 預算名稱
              date:
                type: string
                description: 轉帳日期
              desc:
                type: string
                description: 摘要
              amount:
                type: string
                description: 金額
        allPages:
          type: integer
          description: 總頁數
        page:
          type: integer
          description: 目前頁數
        limit:
          type: integer
          description: 一頁幾筆
        total:
          type: integer
    PutTransfer:
      type: object
      properties:
        id:
          type: string
        budgetId:
          type: string
          description: 預算ID
        tDate:
          type: string
          description: 日期
        summary:
          type: string
          description: 摘要
        debitAccTerm:
          type: array
          items:
            $ref: '#/components/schemas/AccTermWithId'
        creditAccTerm:
          type: array
          items:
            $ref: '#/components/schemas/AccTermWithId'
        deleteAccterm:
          type: array
          items:
            type: string
    TransferDetail:
      type: object
      properties:
        id:
          type: string
        budgetId:
          type: string
          description: 預算ID
        tDate:
          type: string
          description: 日期
        summary:
          type: string
          description: 摘要
        debitAccTerm:
          type: array
          items:
            $ref: '#/components/schemas/AccTermWithId'
        creditAccTerm:
          type: array
          items:
            $ref: '#/components/schemas/AccTermWithId'
    PostTransfer:
      type: object
      properties:
        budgetId:
          type: string
          description: 預算ID
        tDate:
          type: string
          description: 日期
        summary:
          type: string
          description: 摘要
        debitAccTerm:
          $ref: '#/components/schemas/AccTerm'
        creditAccTerm:
          $ref: '#/components/schemas/AccTerm'
    ReceiptDetail:
      type: object
      properties:
        id:
          type: string
        budgetId:
          type: string
        accType:
          type: string
          enum: ["income","expenses"]
          description: 發票類別(收入、支出)
        rDate:
          type: string
          description: 發票日期
        type:
          type: string
          enum: ["electronic", "triplicate", "duplicate"]
          description: 發票類別(電子發票、二聯、三聯)
        number:
          type: string
          description: 發票號碼
        VATnumber:
          type: string
          description: 統一編號
        amount:
          type: integer
          description: 金額
        debitAccTerm:
          $ref: '#/components/schemas/AccTerm'
        creditAccTerm:
          $ref: '#/components/schemas/AccTerm'
    PostReceipt:
      type: object
      properties:
        budgetId:
          type: string
        accType:
          type: string
          enum: ["income","expenses"]
          description: 發票類別(收入、支出)
        rDate:
          type: string
          description: 發票日期
        type:
          type: string
          enum: ["electronic", "triplicate", "duplicate"]
          description: 發票類別(電子發票、二聯、三聯)
        number:
          type: string
          description: 發票號碼
        VATnumber:
          type: string
          description: 統一編號
        amount:
          type: integer
          description: 金額
        debitAccTerm:
          $ref: '#/components/schemas/AccTerm'
        creditAccTerm:
          $ref: '#/components/schemas/AccTerm'
    GetReceiptPagination:
      type: object
      properties:
        rows:
          type: array
          items:
            type: object
            properties:
              id:
                type: string
                description: receiptID
              accType:
                type: string
                enum: ["income","expenses"]
                description: 發票類別(收入、支出)
              date:
                type: string
                description: 發票日期
              number:
                type: string
                description: 發票號碼
              VATnumber:
                type: string
                description: 統一編號
              amount:
                type: integer
                description: 金額
              type:
                type: string
                description: 發票類型
        allPages:
          type: integer
          description: 總頁數
        page:
          type: integer
          description: 目前頁數
        limit:
          type: integer
          description: 一頁幾筆
        total:
          type: integer
    AccTermWithId:
      type: object
      properties:
        id:
          type: string
        code:
          type: string
        name:
          type: string
        amount:
          type: integer
        desc:
          type: string
    AccTerm:
      type: object
      properties:
        code:
          type: string
        name:
          type: string
        amount:
          type: integer
        desc:
          type: string
    AccTermItem:
      type: object
      properties:
        code:
          type: string
        name:
          type: string
    GetAccTermList:
      type: array
      items:
        $ref: '#/components/schemas/AccTermItem'
    BudgetItem:
      type: object
      properties:
        code:
          type: string
        name:
          type: string
        amount:
          type: integer
        desc:
          type: string
    ModifyBudget:
      type: object
      properties:
        id:
          type: string
        year:
          type: integer
        title:
          type: string
        amount:
          type: integer
        startDate:
          type: string
          example: "2018-03-01T00:00:00+08:00"
        endDate:
          type: string
          example: "2018-05-01T00:00:00+08:00"
        income:
          type: array
          items:
            $ref: '#/components/schemas/BudgetItem'
        expenses:
          type: array
          items:
            $ref: '#/components/schemas/BudgetItem'
        parentId:
          type: string
        project:
          type: array
          items:
            type: string
          description: 專案清單
        delProject:
          type: array
          items:
            type: string
          description: 專案清單
    BudgetDetail:
      type: object
      properties:
        id:
          type: string
        year:
          type: integer
        title:
          type: string
        amount:
          type: integer
          description: 預算總額
        parentId:
          type: string
        startDate:
          type: string
          example: "2018-03-01T00:00:00+08:00"
        endDate:
          type: string
          example: "2018-05-01T00:00:00+08:00"
        income:
          type: array
          items:
            $ref: '#/components/schemas/BudgetItem'
        expenses:
          type: array
          items:
            $ref: '#/components/schemas/BudgetItem'
        createTime:
          type: string
        creator:
          type: string
    PostBudget:
      type: object
      properties:
        year:
          type: integer
        title:
          type: string
        type:
          type: string
          enum: [project, year]
        amount:
          type: integer
          description: 預算總額
        startDate:
          type: string
          example: "2018-03-01T00:00:00+08:00"
        endDate:
          type: string
          example: "2018-05-01T00:00:00+08:00"
        income:
          type: array
          items:
            $ref: '#/components/schemas/BudgetItem'
        expenses:
          type: array
          items:
            $ref: '#/components/schemas/BudgetItem'
        parentId:
          type: string
        project:
          type: array
          items:
            type: string
          description: 專案清單
    GetBudget:
      type: array
      items:
        type: object
        properties:
          id:
            type: string
          year:
            type: integer
          title:
            type: string
          income:
            type: integer
          expenses:
            type: integer
          total:
            type: integer
          projectCount:
            type: integer
          startDate:
            type: string
            example: "2018-03-01T00:00:00+08:00"
          endDate:
            type: string
            example: "2018-05-01T00:00:00+08:00"
          createTime:
            type: string
          creator:
            type: string
  securitySchemes:
    ApiKeyAuth:        # arbitrary name for the security scheme
      type: apiKey
      in: header       # can be "header", "query" or "cookie"
      name: Auth-Token  # name of the header, query parameter or cookie