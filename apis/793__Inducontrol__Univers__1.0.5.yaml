openapi: 3.0.0

servers:
  - url: http://195.235.208.224/gestioVendesAPIService/rest/factu/articles/v1

info:
  description: >-
    API destinada a la consulta d'informació de la base de dades de gestió des
    de la web d'Univers
  version: "1.0.5"
  title: API Web Univers Facturació
  contact:
    email: eporcuna@inducontrol.com
tags:
  - name: Crides
    description: Work In Progress
paths:
  /login:
    post:
      tags:
        - Crides
      operationId: getLogin
      description: >
        Retorna el bearer token necesari per a l'Authentication de la resta de
        crides
      requestBody:
        description: Usuari i password d'autentificació
        required: true
        content:
          application/x-www-form-urlencoded:
            schema:
              $ref: '#/components/schemas/Login'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Token'
        '400':
          description: "Usuari/Password Incorrecte"
  /botigues:
    get:
      tags:
        - Crides
      security:
        - BearerAuth: []
      operationId: getBotigues
      description: |
        Retorna la llista de botigues
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Botiga'
        '400':
          description: missatge d'error
  /grups:
    get:
      tags:
        - Crides
      security:
        - BearerAuth: []
      operationId: getGrups
      description: |
        Retorna la llista de grups d'articles web
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Grup'
        '400':
          description: missatge d'error
  /families:
    get:
      tags:
        - Crides
      security:
        - BearerAuth: []
      operationId: getFamilies
      description: |
        Retorna la llista de families d'articles web
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Familia'
        '400':
          description: missatge d'error
  /subfamilies:
    get:
      tags:
        - Crides
      security:
        - BearerAuth: []
      operationId: getSubfamilies
      description: |
        Retorna la llista de subfamilies d'articles web amb la seva familia pare
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Subfamilia'
        '400':
          description: missatge d'error
  /productes:
    get:
      tags:
        - Crides
      security:
        - BearerAuth: []
      operationId: getProductes
      description: |
        Retorna la llista d'articles web
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Producte'
        '400':
          description: missatge d'error
  /marques:
    get:
      tags:
        - Crides
      security:
        - BearerAuth: []
      operationId: getMarques
      description: |
        Retorna la llista de marques d'articles web
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Marca'
        '400':
          description: missatge d'error
  /perfils:
    get:
      tags:
        - Crides
      security:
        - BearerAuth: []
      operationId: getPerfils
      description: |
        Retorna la llista de perfils d'articles web
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Perfil'
        '400':
          description: missatge d'error
  /proveidors:
    get:
      tags:
        - Crides
      security:
        - BearerAuth: []
      operationId: getProveidors
      description: |
        Retorna la llista de proveidors
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Proveidor'
        '400':
          description: missatge d'error
  /caracteristiques/tipus:
    get:
      tags:
        - Crides
      security:
        - BearerAuth: []
      operationId: getCaracteristiquesTipus
      description: |
        Retorna la llista de caracteristiques d'articles
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/TipusCaracteristica'
        '400':
          description: missatge d'error
  /caracteristiques/taules:
    get:
      tags:
        - Crides
      security:
        - BearerAuth: []
      operationId: getCaracteristiquesTaules
      description: |
        Retorna la llista de taules de valors de caracteristiques d'articles
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/TaulaCaracteristica'
        '400':
          description: missatge d'error
  /caracteristiques/articles:
    get:
      tags:
        - Crides
      security:
        - BearerAuth: []
      operationId: getCaracteristiquesArticles
      description: |
        Retorna la llista de valors de les caracteristiques d'articles
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ArticleCaracteristica'
        '400':
          description: missatge d'error
  /estoc:
    post:
      tags:
        - Crides
      security:
        - BearerAuth: []
      operationId: getEstoc
      description: >
        Retorna l'estoc dels articles especificats al body
      requestBody:
        description: Articles a consultar
        required: true
        content:
          application/json:
            schema:
              type: array
              items:
                type: string
                example: "000001036172"
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Estoc'
        '400':
          description: missatge d'error
  /client/{botiga}:
    post:
      tags:
        - Crides
      security:
        - BearerAuth: []
      parameters: 
        - in: path
          name: botiga
          schema:
            type: integer
          required: true
          description: Codi de botiga (Si la botiga és 0, cerca a totes les botigues)
      operationId: getClient
      description: >
        Retorna el client que faci match amb els paràmetres de cerca
      requestBody:
        description: >
          Opcions de tipus de cerca: <br>
          ·  T: telefon <br>
          ·  E: email <br>
          ·  N: NIF <br>
          ·  C: codi (Per cercar per codi cal especificar la botiga)
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                tipus:
                  type: string
                  example: "C"
                valor:
                  type: string
                  example: "2"
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Client'
        '400':
          description: missatge d'error
  /client/new/{botiga}:
    post:
      tags:
        - Crides
      security:
        - BearerAuth: []
      parameters: 
        - in: path
          name: botiga
          schema:
            type: integer
          required: true
          description: Codi de botiga
      operationId: putClient
      description: >
        Crea un nou client
      requestBody:
        description: >
          Si el camp 'cl_proteccio_dades' és 0, el client no es crearà.<br>
          Els valors posibles per a el camp 'cl_politica_enviament' són:<br>
          ·  0: Rep tots els avisos <br>
          ·  1: Només rep avisos de visita <br>
          ·  2: No rep cap avís <br>
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                cl_dni:
                  type: string
                  example: "57954411Z"
                cl_rao:
                  type: string
                  example: "Client Test"
                cl_dir1:
                  type: string
                  example: "Direcció Test"
                cl_cop1:
                  type: string
                  example: "08500"
                cl_pob1:
                  type: string
                  example: "Vic"
                cl_proteccio_dades:
                  type: integer
                  example: 1
                cl_politica_enviament:
                  type: integer
                  example: 0
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Client'
        '400':
          description: missatge d'error
  /comanda/{botiga}:
    post:
      tags:
        - Crides
      security:
        - BearerAuth: []
      parameters: 
        - in: path
          name: botiga
          schema:
            type: integer
          required: true
          description: Codi de botiga
      operationId: getComanda
      description: >
        Retorna la comanda que faci match amb els paràmetres de cerca
      requestBody:
        description: >
          Cerca per codi de client i numero de comanda
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                client:
                  type: integer
                  example: 36
                comanda:
                  type: integer
                  example: 20194521
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Comanda'
        '400':
          description: missatge d'error
  /comanda/{client}/{botiga}:
    get:
      tags:
        - Crides
      security:
        - BearerAuth: []
      operationId: getComandesClient
      description: |
        Retorna la llista de comandes d'un client
      parameters:
        - in: path
          name: client
          schema:
            type: integer
          required: true
          description: Codi del client
        - in: path
          name: botiga
          schema:
            type: integer
          required: true
          description: Codi de botiga
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Comanda'
        '400':
          description: missatge d'error
  /comanda/linies/{botiga}:
    post:
      tags:
        - Crides
      security:
        - BearerAuth: []
      parameters: 
        - in: path
          name: botiga
          schema:
            type: integer
          required: true
          description: Codi de botiga
      operationId: getLiniesComanda
      description: >
        Retorna les linies d'una comanda
      requestBody:
        description: >
          Cerca per codi de client i numero de comanda
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                client:
                  type: integer
                  example: 36
                comanda:
                  type: integer
                  example: 20194521
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/LiniaComanda'
        '400':
          description: missatge d'error
  /comanda/new:
    post:
      tags:
        - Crides
      security:
        - BearerAuth: []
      operationId: putComanda
      description: >
        Insereix una comanda
      requestBody:
        description: >
          Introducció de les dades de la capçalera i les línies de la comanda.
          (Actualment no hi ha gestió de punts)
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                client:
                  type: integer
                  example: 2
                direccio:
                  type: integer
                  example: 1
                botiga:
                  type: integer
                  example: 1
                data:
                  type: string
                  format: date (dd-MM-yyyy)
                  example: "12-06-2019"
                punts:
                  type: integer
                  example: 5
                obs:
                  type: string
                  example: "Observacions"
                linies:
                  type: array
                  items:
                    type: object
                    properties:
                      article:
                        type: string
                        example: "ZOTALINK5"
                      qt:
                        type: number
                        example: 1.0
                      preu:
                        type: number
                        example: 15.8
      responses:
        '200':
          description: Comanda XXXXXXXX creada
        '400':
          description: missatge d'error
  /direccio/sync/{botiga}:
    post:
      tags:
        - Crides
      security:
        - BearerAuth: []
      parameters: 
        - in: path
          name: botiga
          schema:
            type: integer
          required: true
          description: Codi de botiga
      operationId: syncDireccio
      description: >
        Inserta o modifica una direccio
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                num:
                  type: integer
                  example: 1
                client:
                  type: integer
                  example: 2
                cp:
                  type: string
                  example: "08500"
                nometi:
                  type: string
                  example: "Casa"
                domicili:
                  type: string
                  example: "C/Test nº11 4t 4a"
                poblacio:
                  type: string
                  example: "Manlleu"
                provincia:
                  type: string
                  example: "Barcelona"
                pais:
                  type: string
                  example: "Espanya"
                tel:
                  type: string
                  example: "669999999"
      responses:
        '200':
          description: OK
        '400':
          description: missatge d'error
  /direccio/{client}/{botiga}:
    get:
      tags:
        - Crides
      security:
        - BearerAuth: []
      operationId: getDireccionsClient
      description: |
        Retorna les direccions d'un client
      parameters:
        - in: path
          name: client
          schema:
            type: integer
          required: true
          description: Codi del client
        - in: path
          name: botiga
          schema:
            type: integer
          required: true
          description: Codi de botiga
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Direccio'
        '400':
          description: missatge d'error
  /client/telefons/sync/{botiga}:
    post:
      tags:
        - Crides
      security:
        - BearerAuth: []
      parameters: 
        - in: path
          name: botiga
          schema:
            type: integer
          required: true
          description: Codi de botiga
      operationId: syncTelefon
      description: >
        Inserta o modifica un registre telefon/mail
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                ct_cli:
                  type: integer
                  example: 1
                ct_serial:
                  type: integer
                  example: 2
                ct_desc:
                  type: string
                  example: "Mòvil"
                ct_departament:
                  type: string
                  example: "Compres"
                ct_tel:
                  type: string
                  example: "669999999"
                ct_mail:
                  type: string
                  example: "test@mail.com"
      responses:
        '200':
          description: OK
        '400':
          description: missatge d'error
  /client/telefons/{client}/{botiga}:
    get:
      tags:
        - Crides
      security:
        - BearerAuth: []
      operationId: getTelefonsClient
      description: |
        Retorna els registres telefon/mail d'un client
      parameters:
        - in: path
          name: client
          schema:
            type: integer
          required: true
          description: Codi del client
        - in: path
          name: botiga
          schema:
            type: integer
          required: true
          description: Codi de botiga
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Telefon'
        '400':
          description: missatge d'error
  /promocions:
    get:
      tags:
        - Crides
      security:
        - BearerAuth: []
      operationId: getPromocions
      description: |
        Retorna l'informació relacionada amb les promocions vigents'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Promocio'
        '400':
          description: missatge d'error
  /promocions/{promocio}:
    get:
      tags:
        - Crides
      security:
        - BearerAuth: []
      operationId: getDetallPromocio
      description: |
        Retorna el detall de la promoció
      parameters:
        - in: path
          name: promocio
          schema:
            type: integer
          required: true
          description: Codi de la promoció (0 retorna el detall de totes les promocions)
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/DetallPromocio'
        '400':
          description: missatge d'error
components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
  schemas:
    Grup:
      type: object
      properties:
        gr_cod:
          type: integer
          format: key
          example: 1
        gr_desc:
          type: string
          format: description
          example: ALIMENTACIO
    Botiga:
      type: object
      properties:
        botiga:
          type: integer
          format: key
          example: 1
        nom:
          type: string
          format: description
          example: "Botiga A"
        dir:
          type: string
          example: "C/test nº9"
        pob:
          type: string
          example: "Calldetenes"
    Familia:
      type: object
      properties:
        fa_fa:
          type: integer
          format: key
          example: 1
        fa_desc:
          type: string
          format: description
          example: "VACUNES"
    Subfamilia:
      type: object
      properties:
        sf_sf:
          type: integer
          format: key
          example: 1
        sf_desc:
          type: string
          format: description
          example: "VACUNA GOS"
        sf_fam:
          type: integer
          format: foreign key familia
          example: 1
    Login:
      type: object
      properties:
        user:
          type: string
          format: usuari
          example: "conxita"
        password:
          type: string
          format: contrasenya
          example: "conxita1968"
    Producte:
      type: object
      properties:
        ar_codi:
          type: string
          format: key
          example: 00102150826
        ar_desc:
          type: string
          format: description
          example: "ADV.DOG MINI PUPPY PROTECT 800GR"
        ar_descint:
          type: string
          format: description (descripció de treball)
          example: "ADV MINI PROTECT 800"
        ar_grup:
          type: integer
          format: foreign key grup
          example: 10
        ar_fam:
          type: integer
          format: foreign key familia
          example: 100
        ar_subf:
          type: integer
          format: foreign key subfamilia
          example: 1001
        ar_perfil:
          type: integer
          format: foreign key perfil
          example: 1
        ar_marca:
          type: string
          format: foreign key marca
          example: "ADVANCE"
        ar_modelref:
          type: string
          example: ""
        ar_preu:
          type: number
          example: 4.99
        ar_iva:
          type: number
          example: 10
        ar_prove:
          type: integer
          format: foreign key proveidor
          example: 386
        ar_volum:
          type: number
          example: 7.23
        ar_pesnet:
          type: number
          example: 6.4
        
    Marca:
      type: object
      properties:
        mq_marca:
          type: string
          format: key
          example: "ADVANCE"
        mq_desc:
          type: string
          format: description
          example: "ADVANCE"
    Perfil:
      type: object
      properties:
        pf_codi:
          type: integer
          format: key
          example: 1
        pf_desc:
          type: string
          format: description
          example: "GAMMA ALTA"
    Proveidor:
      type: object
      properties:
        pr_codi:
          type: integer
          format: key
          example: 1
        pr_rao:
          type: string
          format: description
          example: "GOSSOS SENSE FRONTERES"
    TipusCaracteristica:
      type: object
      properties:
        car_caracteristica:
          type: integer
          format: key
          example: 2
        car_desc:
          type: string
          format: description
          example: GOS
        car_taula:
          type: integer
          format: boolean (valors a partir de taula)
          example: 0
        car_totart:
          type: integer
          format: boolean (aplicable a tots els articles)
          example: 1
    TaulaCaracteristica:
      type: object
      properties:
        cat_caracteristica:
          type: integer
          format: foreign key tipus caracteristica
          example: 1
        cat_codi:
          type: integer
          format: key
          example: 1
        cat_valor:
          type: string
          example: SI
    ArticleCaracteristica:
      type: object
      properties:
        cav_art:
          type: string
          format: foreign key producte
          example: 00102150826
        cav_caracteristica:
          type: integer
          format: foreign key tipus caracteristica
          example: 1
        cav_codi:
          type: integer
          format: foreign key taula caracteristica (cav_caracteristica,cav_codi)
          example: 1
        cav_valor:
          type: string
          example: SI
    Estoc:
      type: object
      properties:
        ar_botiga:
          type: integer
          format: foreign key botiga
          example: 1
        ar_codi:
          type: string
          format: foreign key producte
          example: "000001036172"
        ar_estoc:
          type: number
          example: 10
        ar_comanpro:
          type: integer
          format: qt reservada per comandes proveidor
          example: 1
    Client:
      type: object
      properties:
        cl_codi:
          type: integer
          format: key
          example: 36
        cl_botiga:
          type: integer
          format: key
          example: 2
        cl_rao:
          type: string
          format: description
          example: "Enriqueta Palomares"
        cl_punts:
          type: integer
          example: 65
        cl_telefons:
          type: array
          items:
            $ref: '#/components/schemas/Telefon'
    Telefon:
      type: object
      properties:
        ct_cli:
          type: integer
          format: codi client
          example: 36
        ct_serial:
          type: integer
          format: key
          example: 2
        cl_desc:
          type: string
          format: description
          example: "Enriqueta Palomares"
        cl_departament:
          type: string
          example: "669999999"
        cl_tel:
          type: string
          example: "enriqueta@correu.com"
        cl_mail:
          type: integer
          example: 65
    Comanda:
      type: object
      properties:
        ped_num:
          type: integer
          format: key (ped_num, ped_cli)
          example: 201354
        ped_cli:
          type: integer
          format: key (ped_num, ped_cli) / foreign key client
          example: 36
        ped_numdir:
          type: integer
          example: 2
        ped_data:
          type: string
          format: date (dd-MM-yy)
          example: "01-01-18"
        ped_imp:
          type: number
          example: 27.8
        ped_pendent:
          type: integer
          format: boolean (la comanda esta pendent)
          example: 1
        ped_punts:
          type: integer
          format: punts gastats en la comanda
          example: 1
    LiniaComanda:
      type: object
      properties:
        ped_lin:
          type: integer
          example: 1
        ped_art:
          type: string
          format: foreign key producte
          example: "ZOTALIN5K"
        ped_des:
          type: string
          format: description
          example: "ZOTALIN 5KG"
        ped_can:
          type: number
          example: 3
        ped_preu:
          type: number
          example: 27
        ped_imp:
          type: number
          example: 81
        ped_pendent:
          type: integer
          format: boolean (la comanda esta pendent)
          example: 1
    Direccio:
      type: object
      properties:
        cl_codi:
          type: integer
          format: foreign key client
          example: 2
        cd_num:
          type: integer
          example: 1
        cd_nometi:
          type: string
          format: description
          example: "CASA"
        cd_dir:
          type: string
          example: "C/Test nº11 3r 5a"
        cd_cop:
          type: string
          example: "08500"
        cd_pob:
          type: string
          example: "TORELLO"
        cd_pro:
          type: string
          example: "BARCELONA"
        cd_pais:
          type: string
          example: "ESPANYA"
        cd_tel:
          type: string
          example: "669999999"
    Promocio:
      type: object
      properties:
        pro_codi:
          type: integer
          format: key
          example: 1
        pro_desc:
          type: string
          format: description
          example: "SNACK BAG FDOG"
        pro_ddata:
          type: string
          format: date (dd-MM-yy)
          example: "01-01-19"
        pro_fdata:
          type: string
          format: date (dd-MM-yy)
          example: "01-05-19"
        pro_mode:
          type: integer
          format: >
              1: Promoció per descompte
              2: Promoció per per preu       
          example: 1
        pro_uvenda:
          type: number
          format: unitats mínimes de venda
          example: 22.0
        pro_dte:
          type: number
          format: descompte
          example: 20.0
    DetallPromocio:
      type: object
      properties:
        prg_codi:
          type: integer
          format: key
          example: 1
        prg_grup:
          type: integer
          format: foreign key grups
          example: 17
        prg_article:
          type: string
          format: foreign key productes
          example: "00494923038934"
        prg_preu:
          type: number
          example: 15.28
    Token:
      type: object
      properties:
        token:
          type: string
          format: uuid
          example: eyJhbGciOiJIUzUxMiJ9.eyJqdGkiOiI0MzNmOTc1ZC1iZjNkLTRhNjctYjE3Yy1kZTUzOTlkMDZiMTgiLCJzdWIiOiJhbmltYWxzZ2kiLCJpc3MiOiJodHRwOi8vMTkyLjE2OC4xMDAuMTM3OjgwODAvZ2VzdGlvVmVuZGVzQVBJU2VydmljZS9yZXN0L2ZhY3R1L2FydGljbGVzL3YxL2xvZ2luIiwiaWF0IjoxNTU3OTExNjM0LCJleHAiOjE1NTc5MTM0MzR9.fg-wFH9ZKJ8k8zrNLhLH74NLOZCSeN_TR7Em9JobbyORBLfT9wI16JtueKjzLz_KatycEaCISq_lisrjia4n5w
        expires:
          type: string
          format: datatime
          example: 15-05-19:11:43